var L,originalL;"undefined"!==typeof exports?L=exports:(originalL=window.L,L={noConflict:function(){window.L=originalL;return this}},window.L=L);L.version="0.4.5";L.Util={extend:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0,d=b.length,e;c<d;c++){e=b[c]||{};for(var f in e)e.hasOwnProperty(f)&&(a[f]=e[f])}return a},bind:function(a,b){var c=2<arguments.length?Array.prototype.slice.call(arguments,2):null;return function(){return a.apply(b,c||arguments)}},stamp:function(){var a=0;return function(b){b._leaflet_id=b._leaflet_id||++a;return b._leaflet_id}}(),limitExecByInterval:function(a,b,c){var d,e;return function g(){var h=arguments;d?e=!0:
(d=!0,setTimeout(function(){d=!1;e&&(g.apply(c,h),e=!1)},b),a.apply(c,h))}},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},splitWords:function(a){return a.replace(/^\s+|\s+$/g,"").split(/\s+/)},setOptions:function(a,b){a.options=L.Util.extend({},a.options,b);return a.options},getParamString:function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return"?"+b.join("&")},template:function(a,b){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,d){var e=b[d];if(!b.hasOwnProperty(d))throw Error("No value provided for variable "+a);return e})},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};
(function(){function a(a){var b,c,d=["webkit","moz","o","ms"];for(b=0;b<d.length&&!c;b++)c=window[d[b]+a];return c}function b(a){return window.setTimeout(a,1E3/60)}var c=window.requestAnimationFrame||a("RequestAnimationFrame")||b,d=window.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(a){window.clearTimeout(a)};L.Util.requestAnimFrame=function(a,d,g,h){a=L.Util.bind(a,d);if(g&&c===b)a();else return c.call(window,a,h)};L.Util.cancelAnimFrame=function(a){a&&
d.call(window,a)}})();L.extend=L.Util.extend;L.bind=L.Util.bind;L.stamp=L.Util.stamp;L.setOptions=L.Util.setOptions;L.Class=function(){};
L.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments)},c=function(){};c.prototype=this.prototype;c=new c;c.constructor=b;b.prototype=c;for(var d in this)this.hasOwnProperty(d)&&"prototype"!==d&&(b[d]=this[d]);a.statics&&(L.Util.extend(b,a.statics),delete a.statics);a.includes&&(L.Util.extend.apply(null,[c].concat(a.includes)),delete a.includes);a.options&&c.options&&(a.options=L.Util.extend({},c.options,a.options));L.Util.extend(c,a);return b};
L.Class.include=function(a){L.Util.extend(this.prototype,a)};L.Class.mergeOptions=function(a){L.Util.extend(this.prototype.options,a)};var key="_leaflet_events";L.Mixin={};
L.Mixin.Events={addEventListener:function(a,b,c){var d=this[key]=this[key]||{},e,f;if("object"===typeof a){for(e in a)a.hasOwnProperty(e)&&this.addEventListener(e,a[e],b);return this}a=L.Util.splitWords(a);e=0;for(f=a.length;e<f;e++)d[a[e]]=d[a[e]]||[],d[a[e]].push({action:b,context:c||this});return this},hasEventListeners:function(a){return key in this&&a in this[key]&&0<this[key][a].length},removeEventListener:function(a,b,c){var d=this[key],e,f,g,h;if("object"===typeof a){for(e in a)a.hasOwnProperty(e)&&
this.removeEventListener(e,a[e],b);return this}a=L.Util.splitWords(a);e=0;for(f=a.length;e<f;e++)if(this.hasEventListeners(a[e])){g=d[a[e]];for(h=g.length-1;0<=h;h--)(!b||g[h].action===b)&&(!c||g[h].context===c)&&g.splice(h,1)}return this},fireEvent:function(a,b){if(!this.hasEventListeners(a))return this;for(var c=L.Util.extend({type:a,target:this},b),d=this[key][a].slice(),e=0,f=d.length;e<f;e++)d[e].action.call(d[e].context||this,c);return this}};L.Mixin.Events.on=L.Mixin.Events.addEventListener;
L.Mixin.Events.off=L.Mixin.Events.removeEventListener;L.Mixin.Events.fire=L.Mixin.Events.fireEvent;(function(){var a=!!window.ActiveXObject,b=a&&!window.XMLHttpRequest,c=a&&!document.querySelector,d=navigator.userAgent.toLowerCase(),e=-1!==d.indexOf("webkit"),f=-1!==d.indexOf("chrome"),g=-1!==d.indexOf("android"),d=-1!==d.search("android [23]"),h="undefined"!==typeof orientation,i=window.navigator&&window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints,j="devicePixelRatio"in window&&1<window.devicePixelRatio||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,
k=document.documentElement,l=a&&"transition"in k.style,m="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix,n="MozPerspective"in k.style,p="OTransition"in k.style,q=!window.L_DISABLE_3D&&(l||m||n||p),r=!window.L_NO_TOUCH&&function(){if(i||"ontouchstart"in k)return!0;var a=document.createElement("div"),b=!1;if(!a.setAttribute)return!1;a.setAttribute("ontouchstart","return;");"function"===typeof a.ontouchstart&&(b=!0);a.removeAttribute("ontouchstart");return b}();L.Browser={ie:a,ie6:b,ie7:c,
webkit:e,android:g,android23:d,chrome:f,ie3d:l,webkit3d:m,gecko3d:n,opera3d:p,any3d:q,mobile:h,mobileWebkit:h&&e,mobileWebkit3d:h&&m,mobileOpera:h&&window.opera,touch:r,msTouch:i,retina:j}})();L.Point=function(a,b,c){this.x=c?Math.round(a):a;this.y=c?Math.round(b):b};
L.Point.prototype={add:function(a){return this.clone()._add(L.point(a))},_add:function(a){this.x+=a.x;this.y+=a.y;return this},subtract:function(a){return this.clone()._subtract(L.point(a))},_subtract:function(a){this.x-=a.x;this.y-=a.y;return this},divideBy:function(a,b){return new L.Point(this.x/a,this.y/a,b)},multiplyBy:function(a,b){return new L.Point(this.x*a,this.y*a,b)},distanceTo:function(a){var a=L.point(a),b=a.x-this.x,a=a.y-this.y;return Math.sqrt(b*b+a*a)},round:function(){return this.clone()._round()},
_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},clone:function(){return new L.Point(this.x,this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}};L.point=function(a,b,c){return a instanceof L.Point?a:a instanceof Array?new L.Point(a[0],a[1]):isNaN(a)?a:new L.Point(a,b,c)};L.Bounds=L.Class.extend({initialize:function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;d<e;d++)this.extend(c[d])},extend:function(a){a=L.point(a);!this.min&&!this.max?(this.min=a.clone(),this.max=a.clone()):(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y));return this},getCenter:function(a){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new L.Point(this.min.x,
this.max.y)},getTopRight:function(){return new L.Point(this.max.x,this.min.y)},contains:function(a){var b,a="number"===typeof a[0]||a instanceof L.Point?L.point(a):L.bounds(a);a instanceof L.Bounds?(b=a.min,a=a.max):b=a;return b.x>=this.min.x&&a.x<=this.max.x&&b.y>=this.min.y&&a.y<=this.max.y},intersects:function(a){var a=L.bounds(a),b=this.min,c=this.max,d=a.min,a=a.max,e=a.y>=b.y&&d.y<=c.y;return a.x>=b.x&&d.x<=c.x&&e}});L.bounds=function(a,b){return!a||a instanceof L.Bounds?a:new L.Bounds(a,b)};L.Transformation=L.Class.extend({initialize:function(a,b,c,d){this._a=a;this._b=b;this._c=c;this._d=d},transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){b=b||1;a.x=b*(this._a*a.x+this._b);a.y=b*(this._c*a.y+this._d);return a},untransform:function(a,b){b=b||1;return new L.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}});L.DomUtil={get:function(a){return"string"===typeof a?document.getElementById(a):a},getStyle:function(a,b){var c=a.style[b];!c&&a.currentStyle&&(c=a.currentStyle[b]);if(!c||"auto"===c)c=(c=document.defaultView.getComputedStyle(a,null))?c[b]:null;return"auto"===c?null:c},getViewportOffset:function(a){var b=0,c=0,d=a,e=document.body;do{b+=d.offsetTop||0;c+=d.offsetLeft||0;if(d.offsetParent===e&&"absolute"===L.DomUtil.getStyle(d,"position"))break;if("fixed"===L.DomUtil.getStyle(d,"position")){b+=e.scrollTop||
0;c+=e.scrollLeft||0;break}d=d.offsetParent}while(d);d=a;do{if(d===e)break;b-=d.scrollTop||0;c-=d.scrollLeft||0;d=d.parentNode}while(d);return new L.Point(c,b)},create:function(a,b,c){a=document.createElement(a);a.className=b;c&&c.appendChild(a);return a},disableTextSelection:function(){document.selection&&document.selection.empty&&document.selection.empty();this._onselectstart||(this._onselectstart=document.onselectstart,document.onselectstart=L.Util.falseFn)},enableTextSelection:function(){document.onselectstart===
L.Util.falseFn&&(document.onselectstart=this._onselectstart,this._onselectstart=null)},hasClass:function(a,b){return 0<a.className.length&&RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},addClass:function(a,b){L.DomUtil.hasClass(a,b)||(a.className+=(a.className?" ":"")+b)},removeClass:function(a,b){a.className=a.className.replace(/(\S+)\s*/g,function(a,d){return d===b?"":a}).replace(/(^\s+|\s+$)/,"")},setOpacity:function(a,b){if("opacity"in a.style)a.style.opacity=b;else if(L.Browser.ie){var c=!1;
try{c=a.filters.item("DXImageTransform.Microsoft.Alpha")}catch(d){}b=Math.round(100*b);c?(c.Enabled=100!==b,c.Opacity=b):a.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")"}},testProp:function(a){for(var b=document.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1},getTranslateString:function(a){var b=L.Browser.webkit3d;return"translate"+(b?"3d":"")+"("+a.x+"px,"+a.y+"px"+((b?",0":"")+")")},getScaleString:function(a,b){return L.DomUtil.getTranslateString(b.add(b.multiplyBy(-1*
a)))+(" scale("+a+") ")},setPosition:function(a,b,c){a._leaflet_pos=b;!c&&L.Browser.any3d?(a.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(b),L.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden")):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._leaflet_pos}};
L.Util.extend(L.DomUtil,{TRANSITION:L.DomUtil.testProp(["transition","webkitTransition","OTransition","MozTransition","msTransition"]),TRANSFORM:L.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"])});L.LatLng=function(a,b,c){var d=parseFloat(a),e=parseFloat(b);if(isNaN(d)||isNaN(e))throw Error("Invalid LatLng object: ("+a+", "+b+")");!0!==c&&(d=Math.max(Math.min(d,90),-90),e=(e+180)%360+(-180>e||180===e?180:-180));this.lat=d;this.lng=e};L.Util.extend(L.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1E-9});
L.LatLng.prototype={equals:function(a){if(!a)return!1;a=L.latLng(a);return Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng))<=L.LatLng.MAX_MARGIN},toString:function(){return"LatLng("+L.Util.formatNum(this.lat)+", "+L.Util.formatNum(this.lng)+")"},distanceTo:function(a){var a=L.latLng(a),b=L.LatLng.DEG_TO_RAD,c=(a.lng-this.lng)*b,d=this.lat*b,e=a.lat*b,a=Math.sin((a.lat-this.lat)*b/2),c=Math.sin(c/2),d=a*a+c*c*Math.cos(d)*Math.cos(e);return 12756274*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}};
L.latLng=function(a,b,c){return a instanceof L.LatLng?a:a instanceof Array?new L.LatLng(a[0],a[1]):isNaN(a)?a:new L.LatLng(a,b,c)};L.LatLngBounds=L.Class.extend({initialize:function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;d<e;d++)this.extend(c[d])},extend:function(a){a="number"===typeof a[0]||a instanceof L.LatLng?L.latLng(a):L.latLngBounds(a);a instanceof L.LatLng?!this._southWest&&!this._northEast?(this._southWest=new L.LatLng(a.lat,a.lng,!0),this._northEast=new L.LatLng(a.lat,a.lng,!0)):(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=
Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):a instanceof L.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast));return this},pad:function(a){var b=this._southWest,c=this._northEast,d=Math.abs(b.lat-c.lat)*a,a=Math.abs(b.lng-c.lng)*a;return new L.LatLngBounds(new L.LatLng(b.lat-d,b.lng-a),new L.LatLng(c.lat+d,c.lng+a))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/
2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new L.LatLng(this._northEast.lat,this._southWest.lng,!0)},getSouthEast:function(){return new L.LatLng(this._southWest.lat,this._northEast.lng,!0)},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(a){var a="number"===
typeof a[0]||a instanceof L.LatLng?L.latLng(a):L.latLngBounds(a),b=this._southWest,c=this._northEast,d;a instanceof L.LatLngBounds?(d=a.getSouthWest(),a=a.getNorthEast()):d=a;return d.lat>=b.lat&&a.lat<=c.lat&&d.lng>=b.lng&&a.lng<=c.lng},intersects:function(a){var a=L.latLngBounds(a),b=this._southWest,c=this._northEast,d=a.getSouthWest(),a=a.getNorthEast(),e=a.lng>=b.lng&&d.lng<=c.lng;return a.lat>=b.lat&&d.lat<=c.lat&&e},toBBoxString:function(){var a=this._southWest,b=this._northEast;return[a.lng,
a.lat,b.lng,b.lat].join()},equals:function(a){if(!a)return!1;a=L.latLngBounds(a);return this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())}});L.latLngBounds=function(a,b){return!a||a instanceof L.LatLngBounds?a:new L.LatLngBounds(a,b)};L.Projection={};L.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(a){var b=L.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,c=Math.max(Math.min(c,a.lat),-c),a=a.lng*b,b=Math.log(Math.tan(Math.PI/4+c*b/2));return new L.Point(a,b)},unproject:function(a){var b=L.LatLng.RAD_TO_DEG,c=a.x*b,a=(2*Math.atan(Math.exp(a.y))-Math.PI/2)*b;return new L.LatLng(a,c,!0)}};L.Projection.LonLat={project:function(a){return new L.Point(a.lng,a.lat)},unproject:function(a){return new L.LatLng(a.y,a.x,!0)}};L.CRS={latLngToPoint:function(a,b){var c=this.projection.project(a),d=this.scale(b);return this.transformation._transform(c,d)},pointToLatLng:function(a,b){var c=this.scale(b),c=this.transformation.untransform(a,c);return this.projection.unproject(c)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)}};L.CRS.EPSG3857=L.Util.extend({},L.CRS,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:new L.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(a){return this.projection.project(a).multiplyBy(6378137)}});L.CRS.EPSG900913=L.Util.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"});L.CRS.EPSG4326=L.Util.extend({},L.CRS,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/360,0.5,-1/360,0.5)});L.Map=L.Class.extend({includes:L.Mixin.Events,options:{crs:L.CRS.EPSG3857,fadeAnimation:L.DomUtil.TRANSITION&&!L.Browser.android23,trackResize:!0,markerZoomAnimation:L.DomUtil.TRANSITION&&L.Browser.any3d},initialize:function(a,b){b=L.Util.setOptions(this,b);this._initContainer(a);this._initLayout();this._initHooks();this._initEvents();b.maxBounds&&this.setMaxBounds(b.maxBounds);b.center&&void 0!==b.zoom&&this.setView(L.latLng(b.center),b.zoom,!0);this._initLayers(b.layers)},setView:function(a,b){this._resetView(L.latLng(a),
this._limitZoom(b));return this},setZoom:function(a){return this.setView(this.getCenter(),a)},zoomIn:function(){return this.setZoom(this._zoom+1)},zoomOut:function(){return this.setZoom(this._zoom-1)},fitBounds:function(a){var b=this.getBoundsZoom(a);return this.setView(L.latLngBounds(a).getCenter(),b)},fitWorld:function(){var a=new L.LatLng(-60,-170),b=new L.LatLng(85,179);return this.fitBounds(new L.LatLngBounds(a,b))},panTo:function(a){return this.setView(a,this._zoom)},panBy:function(a){this.fire("movestart");
this._rawPanBy(L.point(a));this.fire("move");return this.fire("moveend")},setMaxBounds:function(a){a=L.latLngBounds(a);this.options.maxBounds=a;if(!a)return this._boundsMinZoom=null,this;var b=this.getBoundsZoom(a,!0);this._boundsMinZoom=b;this._loaded&&(this._zoom<b?this.setView(a.getCenter(),b):this.panInsideBounds(a));return this},panInsideBounds:function(a){var a=L.latLngBounds(a),b=this.getBounds(),c=this.project(b.getSouthWest()),b=this.project(b.getNorthEast()),d=this.project(a.getSouthWest()),
a=this.project(a.getNorthEast()),e=0,f=0;b.y<a.y&&(f=a.y-b.y);b.x>a.x&&(e=a.x-b.x);c.y>d.y&&(f=d.y-c.y);c.x<d.x&&(e=d.x-c.x);return this.panBy(new L.Point(e,f,!0))},addLayer:function(a){var b=L.Util.stamp(a);if(this._layers[b])return this;this._layers[b]=a;a.options&&!isNaN(a.options.maxZoom)&&(this._layersMaxZoom=Math.max(this._layersMaxZoom||0,a.options.maxZoom));a.options&&!isNaN(a.options.minZoom)&&(this._layersMinZoom=Math.min(this._layersMinZoom||Infinity,a.options.minZoom));this.options.zoomAnimation&&
(L.TileLayer&&a instanceof L.TileLayer)&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this));b=function(){a.onAdd(this);this.fire("layeradd",{layer:a})};if(this._loaded)b.call(this);else this.on("load",b,this);return this},removeLayer:function(a){var b=L.Util.stamp(a);if(this._layers[b]){try{a.onRemove(this)}catch(c){}delete this._layers[b];this.options.zoomAnimation&&(L.TileLayer&&a instanceof L.TileLayer)&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",
this._onTileLayerLoad,this));return this.fire("layerremove",{layer:a})}},hasLayer:function(a){a=L.Util.stamp(a);return this._layers.hasOwnProperty(a)},invalidateSize:function(a){var b=this.getSize();this._sizeChanged=!0;this.options.maxBounds&&this.setMaxBounds(this.options.maxBounds);if(!this._loaded)return this;b=b.subtract(this.getSize()).divideBy(2,!0);!0===a?this.panBy(b):(this._rawPanBy(b),this.fire("move"),clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(L.Util.bind(this.fire,this,
"moveend"),200));return this},addHandler:function(a,b){if(b)return this[a]=new b(this),this.options[a]&&this[a].enable(),this},getCenter:function(){return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var a=this.getPixelBounds(),b=this.unproject(a.getBottomLeft()),a=this.unproject(a.getTopRight());return new L.LatLngBounds(b,a)},getMinZoom:function(){return Math.max(this.options.minZoom||0,this._layersMinZoom||0,this._boundsMinZoom||
0)},getMaxZoom:function(){return Math.min(void 0===this.options.maxZoom?Infinity:this.options.maxZoom,void 0===this._layersMaxZoom?Infinity:this._layersMaxZoom)},getBoundsZoom:function(a,b){var a=L.latLngBounds(a),c=this.getSize(),d=this.options.minZoom||0,e=this.getMaxZoom(),f=a.getNorthEast(),g=a.getSouthWest(),h,i;h=!0;b&&d--;do d++,h=this.project(f,d),i=this.project(g,d),h=new L.Point(Math.abs(h.x-i.x),Math.abs(i.y-h.y)),h=b?h.x<c.x||h.y<c.y:h.x<=c.x&&h.y<=c.y;while(h&&d<=e);return h&&b?null:
b?d:d-1},getSize:function(){if(!this._size||this._sizeChanged)this._size=new L.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1;return this._size},getPixelBounds:function(){var a=this._getTopLeftPoint();return new L.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a){var b=this.options.crs;return b.scale(a)/b.scale(this._zoom)},
getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2},project:function(a,b){b=void 0===b?this._zoom:b;return this.options.crs.latLngToPoint(L.latLng(a),b)},unproject:function(a,b){b=void 0===b?this._zoom:b;return this.options.crs.pointToLatLng(L.point(a),b)},layerPointToLatLng:function(a){a=L.point(a).add(this._initialTopLeftPoint);return this.unproject(a)},latLngToLayerPoint:function(a){return this.project(L.latLng(a))._round()._subtract(this._initialTopLeftPoint)},containerPointToLayerPoint:function(a){return L.point(a).subtract(this._getMapPanePos())},
layerPointToContainerPoint:function(a){return L.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){a=this.containerPointToLayerPoint(L.point(a));return this.layerPointToLatLng(a)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(a)))},mouseEventToContainerPoint:function(a){return L.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},
mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){a=this._container=L.DomUtil.get(a);if(a._leaflet)throw Error("Map container is already initialized.");a._leaflet=!0},_initLayout:function(){var a=this._container;a.innerHTML="";L.DomUtil.addClass(a,"leaflet-container");L.Browser.touch&&L.DomUtil.addClass(a,"leaflet-touch");this.options.fadeAnimation&&L.DomUtil.addClass(a,"leaflet-fade-anim");var b=L.DomUtil.getStyle(a,"position");
"absolute"!==b&&("relative"!==b&&"fixed"!==b)&&(a.style.position="relative");this._initPanes();this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);this._objectsPane=a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);a.shadowPane=this._createPane("leaflet-shadow-pane");a.overlayPane=this._createPane("leaflet-overlay-pane");
a.markerPane=this._createPane("leaflet-marker-pane");a.popupPane=this._createPane("leaflet-popup-pane");this.options.markerZoomAnimation||(L.DomUtil.addClass(a.markerPane," leaflet-zoom-hide"),L.DomUtil.addClass(a.shadowPane," leaflet-zoom-hide"),L.DomUtil.addClass(a.popupPane," leaflet-zoom-hide"))},_createPane:function(a,b){return L.DomUtil.create("div",a,b||this._objectsPane)},_initializers:[],_initHooks:function(){var a,b;a=0;for(b=this._initializers.length;a<b;a++)this._initializers[a].call(this)},
_initLayers:function(a){a=a?a instanceof Array?a:[a]:[];this._layers={};this._tileLayersNum=0;var b,c;b=0;for(c=a.length;b<c;b++)this.addLayer(a[b])},_resetView:function(a,b,c,d){var e=this._zoom!==b;d||(this.fire("movestart"),e&&this.fire("zoomstart"));this._zoom=b;this._initialTopLeftPoint=this._getNewTopLeftPoint(a);c?this._initialTopLeftPoint._add(this._getMapPanePos()):L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));this._tileLayersToLoad=this._tileLayersNum;this.fire("viewreset",{hard:!c});
this.fire("move");(e||d)&&this.fire("zoomend");this.fire("moveend",{hard:!c});this._loaded||(this._loaded=!0,this.fire("load"))},_rawPanBy:function(a){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_initEvents:function(){if(L.DomEvent){L.DomEvent.on(this._container,"click",this._onMouseClick,this);var a="dblclick mousedown mouseup mouseenter mouseleave mousemove contextmenu".split(" "),b,c;b=0;for(c=a.length;b<c;b++)L.DomEvent.on(this._container,a[b],this._fireMouseEvent,
this);this.options.trackResize&&(this._onResize(),L.DomEvent.on(window,"resize",this._onResize,this))}},_onResize:function(){this._onResizeTimeout&&clearTimeout(this._onResizeTimeout);this._onResizeTimeout=setTimeout(L.Util.bind(this._onResizeDelayed,this),100)},_onResizeDelayed:function(){this.invalidateSize();this.fire("resized")},_onMouseClick:function(a){if(this._loaded&&(!this.dragging||!this.dragging.moved()))this.fire("preclick"),this._fireMouseEvent(a)},_fireMouseEvent:function(a){if(this._loaded){var b=
a.type,b="mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b;if(this.hasEventListeners(b)){"contextmenu"===b&&L.DomEvent.preventDefault(a);var c=this.mouseEventToContainerPoint(a),d=this.containerPointToLayerPoint(c),e=this.layerPointToLatLng(d);this.fire(b,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--;this._tileLayersNum&&(!this._tileLayersToLoad&&this._tileBg)&&(clearTimeout(this._clearTileBgTimer),this._clearTileBgTimer=
setTimeout(L.Util.bind(this._clearTileBg,this),500))},whenReady:function(a,b){if(this._loaded)a.call(b||this,this);else this.on("load",a,b);return this},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane)},_getTopLeftPoint:function(){if(!this._loaded)throw Error("Set map center and zoom first.");return this._initialTopLeftPoint.subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(a,b){var c=this.getSize().divideBy(2);return this.project(a,b)._subtract(c)._round()},_latLngToNewLayerPoint:function(a,
b,c){c=this._getNewTopLeftPoint(c,b).add(this._getMapPanePos());return this.project(a,b)._subtract(c)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize().divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitZoom:function(a){var b=this.getMinZoom(),c=this.getMaxZoom();return Math.max(b,Math.min(c,a))}});
L.Map.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1);this.prototype._initializers.push("function"===typeof a?a:function(){this[a].apply(this,b)})};L.map=function(a,b){return new L.Map(a,b)};L.TileLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(a,b){b=L.Util.setOptions(this,b);b.detectRetina&&(L.Browser.retina&&0<b.maxZoom)&&(b.tileSize=Math.floor(b.tileSize/2),b.zoomOffset++,0<b.minZoom&&b.minZoom--,this.options.maxZoom--);this._url=a;var c=this.options.subdomains;"string"===typeof c&&
(this.options.subdomains=c.split(""))},onAdd:function(a){this._map=a;this._initContainer();this._createTileProto();a.on({viewreset:this._resetCallback,moveend:this._update},this);this.options.updateWhenIdle||(this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this));this._reset();this._update()},addTo:function(a){a.addLayer(this);return this},onRemove:function(a){a._panes&&(a._panes.tilePane&&this._container)&&a._panes.tilePane.removeChild(this._container);
a.off({viewreset:this._resetCallback,moveend:this._update},this);this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this);this._map=this._container=null},bringToFront:function(){var a=this._map._panes.tilePane;this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max));return this},bringToBack:function(){var a=this._map._panes.tilePane;this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min));return this},getAttribution:function(){return this.options.attribution},
setOpacity:function(a){this.options.opacity=a;this._map&&this._updateOpacity();return this},setZIndex:function(a){this.options.zIndex=a;this._updateZIndex();return this},setUrl:function(a,b){this._url=a;b||this.redraw();return this},redraw:function(){this._map&&(this._map._panes.tilePane.empty=!1,this._reset(!0),this._update());return this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(a,b){for(var c=
a.children,d=-b(Infinity,-Infinity),e,f=0,g=c.length;f<g;f++)c[f]!==this._container&&(e=parseInt(c[f].style.zIndex,10),isNaN(e)||(d=b(d,e)));this._container.style.zIndex=isFinite(d)?d+b(1,-1):""},_updateOpacity:function(){L.DomUtil.setOpacity(this._container,this.options.opacity);var a,b=this._tiles;if(L.Browser.webkit)for(a in b)b.hasOwnProperty(a)&&(b[a].style.webkitTransform+=" translate(0,0)")},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container||a.empty)this._container=
L.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),a.appendChild(this._container),1>this.options.opacity&&this._updateOpacity()},_resetCallback:function(a){this._reset(a.hard)},_reset:function(a){var b,c=this._tiles;for(b in c)c.hasOwnProperty(b)&&this.fire("tileunload",{tile:c[b]});this._tiles={};this._tilesToLoad=0;this.options.reuseTiles&&(this._unusedTiles=[]);a&&this._container&&(this._container.innerHTML="");this._initContainer()},_update:function(){if(this._map&&(!this._map._panTransition||
!this._map._panTransition._inProgress)){var a=this._map.getPixelBounds(),b=this._map.getZoom(),c=this.options.tileSize;b>this.options.maxZoom||b<this.options.minZoom||(b=new L.Point(Math.floor(a.min.x/c),Math.floor(a.min.y/c)),a=new L.Point(Math.floor(a.max.x/c),Math.floor(a.max.y/c)),a=new L.Bounds(b,a),this._addTilesFromCenterOut(a),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(a))}},_addTilesFromCenterOut:function(a){var b=[],c=a.getCenter(),d,e,f;for(d=a.min.y;d<=
a.max.y;d++)for(e=a.min.x;e<=a.max.x;e++)f=new L.Point(e,d),this._tileShouldBeLoaded(f)&&b.push(f);a=b.length;if(0!==a){b.sort(function(a,b){return a.distanceTo(c)-b.distanceTo(c)});d=document.createDocumentFragment();this._tilesToLoad||this.fire("loading");this._tilesToLoad+=a;for(e=0;e<a;e++)this._addTile(b[e],d);this._container.appendChild(d)}},_tileShouldBeLoaded:function(a){if(a.x+":"+a.y in this._tiles)return!1;if(!this.options.continuousWorld){var b=this._getWrapTileNum();if(this.options.noWrap&&
(0>a.x||a.x>=b)||0>a.y||a.y>=b)return!1}return!0},_removeOtherTiles:function(a){var b,c,d;for(d in this._tiles)this._tiles.hasOwnProperty(d)&&(b=d.split(":"),c=parseInt(b[0],10),b=parseInt(b[1],10),(c<a.min.x||c>a.max.x||b<a.min.y||b>a.max.y)&&this._removeTile(d))},_removeTile:function(a){var b=this._tiles[a];this.fire("tileunload",{tile:b,url:b.src});this.options.reuseTiles?(L.DomUtil.removeClass(b,"leaflet-tile-loaded"),this._unusedTiles.push(b)):b.parentNode===this._container&&this._container.removeChild(b);
L.Browser.android||(b.src=L.Util.emptyImageUrl);delete this._tiles[a]},_addTile:function(a,b){var c=this._getTilePos(a),d=this._getTile();L.DomUtil.setPosition(d,c,L.Browser.chrome||L.Browser.android23);this._tiles[a.x+":"+a.y]=d;this._loadTile(d,a);d.parentNode!==this._container&&b.appendChild(d)},_getZoomForUrl:function(){var a=this.options,b=this._map.getZoom();a.zoomReverse&&(b=a.maxZoom-b);return b+a.zoomOffset},_getTilePos:function(a){var b=this._map.getPixelOrigin();return a.multiplyBy(this.options.tileSize).subtract(b)},
getTileUrl:function(a){this._adjustTilePoint(a);return L.Util.template(this._url,L.Util.extend({s:this._getSubdomain(a),z:this._getZoomForUrl(),x:a.x,y:a.y},this.options))},_getWrapTileNum:function(){return Math.pow(2,this._getZoomForUrl())},_adjustTilePoint:function(a){var b=this._getWrapTileNum();!this.options.continuousWorld&&!this.options.noWrap&&(a.x=(a.x%b+b)%b);this.options.tms&&(a.y=b-a.y-1)},_getSubdomain:function(a){return this.options.subdomains[(a.x+a.y)%this.options.subdomains.length]},
_createTileProto:function(){var a=this._tileImg=L.DomUtil.create("img","leaflet-tile");a.galleryimg="no";var b=this.options.tileSize;a.style.width=b+"px";a.style.height=b+"px"},_getTile:function(){if(this.options.reuseTiles&&0<this._unusedTiles.length){var a=this._unusedTiles.pop();this._resetTile(a);return a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=this._tileImg.cloneNode(!1);a.onselectstart=a.onmousemove=L.Util.falseFn;return a},_loadTile:function(a,b){a._layer=
this;a.onload=this._tileOnLoad;a.onerror=this._tileOnError;a.src=this.getTileUrl(b)},_tileLoaded:function(){this._tilesToLoad--;this._tilesToLoad||this.fire("load")},_tileOnLoad:function(){if("naturalHeight"in this){if(0===this.naturalHeight+this.naturalWidth){this.onerror();return}}else if(0==this.width+this.height){this.onerror();return}var a=this._layer;this.src!==L.Util.emptyImageUrl&&(L.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src}));a._tileLoaded()},
_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;b&&(this.src=b);a._tileLoaded()}});L.tileLayer=function(a,b){return new L.TileLayer(a,b)};L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(a,b){this._url=a;var c=L.Util.extend({},this.defaultWmsParams);c.width=b.detectRetina&&L.Browser.retina?c.height=2*this.options.tileSize:c.height=this.options.tileSize;for(var d in b)this.options.hasOwnProperty(d)||(c[d]=b[d]);this.wmsParams=c;L.Util.setOptions(this,b)},onAdd:function(a){var b=1.3<=parseFloat(this.wmsParams.version)?
"crs":"srs";this.wmsParams[b]=a.options.crs.code;L.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(a,b){var c=this._map,d=c.options.crs,e=this.options.tileSize,f=a.multiplyBy(e),e=f.add(new L.Point(e,e)),f=d.project(c.unproject(f,b)),c=d.project(c.unproject(e,b)),c=[f.x,c.y,c.x,f.y].join();return L.Util.template(this._url,{s:this._getSubdomain(a)})+L.Util.getParamString(this.wmsParams)+"&bbox="+c},setParams:function(a,b){L.Util.extend(this.wmsParams,a);b||this.redraw();return this}});
L.tileLayer.wms=function(a,b){return new L.TileLayer.WMS(a,b)};L.TileLayer.Canvas=L.TileLayer.extend({options:{async:!1},initialize:function(a){L.Util.setOptions(this,a)},redraw:function(){var a,b=this._tiles;for(a in b)b.hasOwnProperty(a)&&this._redrawTile(b[a])},_redrawTile:function(a){this.drawTile(a,a._tilePoint,a._zoom)},_createTileProto:function(){var a=this._canvasProto=L.DomUtil.create("canvas","leaflet-tile"),b=this.options.tileSize;a.width=b;a.height=b},_createTile:function(){var a=this._canvasProto.cloneNode(!1);a.onselectstart=a.onmousemove=L.Util.falseFn;
return a},_loadTile:function(a,b,c){a._layer=this;a._tilePoint=b;a._zoom=c;this.drawTile(a,b,c);this.options.async||this.tileDrawn(a)},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}});L.tileLayer.canvas=function(a){return new L.TileLayer.Canvas(a)};L.Icon=L.Class.extend({options:{className:""},initialize:function(a){L.Util.setOptions(this,a)},createIcon:function(){return this._createIcon("icon")},createShadow:function(){return this._createIcon("shadow")},_createIcon:function(a){var b=this._getIconUrl(a);if(!b){if("icon"===a)throw Error("iconUrl not set in Icon options (see the docs).");return null}b=this._createImg(b);this._setIconStyles(b,a);return b},_setIconStyles:function(a,b){var c=this.options,d=L.point(c[b+"Size"]),e;e="shadow"===b?L.point(c.shadowAnchor||
c.iconAnchor):L.point(c.iconAnchor);!e&&d&&(e=d.divideBy(2,!0));a.className="leaflet-marker-"+b+" "+c.className;e&&(0!==e.x&&(a.style.marginLeft=-e.x+"px"),0!==e.y&&(a.style.marginTop=-e.y+"px"));d&&(a.style.width=d.x+"px",a.style.height=d.y+"px")},_createImg:function(a){var b;L.Browser.ie6?(b=document.createElement("div"),b.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+a+'")'):(b=document.createElement("img"),b.src=a);return b},_getIconUrl:function(a){return this.options[a+
"Url"]}});L.icon=function(a){return new L.Icon(a)};L.Icon.Default=L.Icon.extend({options:{iconSize:new L.Point(25,41),iconAnchor:new L.Point(13,41),popupAnchor:new L.Point(1,-34),shadowSize:new L.Point(41,41)},_getIconUrl:function(a){var b=a+"Url";if(this.options[b])return this.options[b];b=L.Icon.Default.imagePath;if(!b)throw Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return b+"/marker-"+a+".png"}});
L.Icon.Default.imagePath=function(){var a=document.getElementsByTagName("script"),b=/\/?production[\-\._]?([\w\-\._]*)\.js\??/,c,d,e,f;c=0;for(d=a.length;c<d;c++)if(e=a[c].src,f=e.match(b))return e.split(b)[0]+"/../img"}();L.Marker=L.Class.extend({includes:L.Mixin.Events,options:{icon:new L.Icon.Default,title:"",clickable:!0,draggable:!1,zIndexOffset:0,opacity:1},initialize:function(a,b){L.Util.setOptions(this,b);this._latlng=L.latLng(a)},onAdd:function(a){this._map=a;a.on("viewreset",this.update,this);this._initIcon();this.update();if(a.options.zoomAnimation&&a.options.markerZoomAnimation)a.on("zoomanim",this._animateZoom,this)},addTo:function(a){a.addLayer(this);return this},onRemove:function(a){this._removeIcon();
this.closePopup&&this.closePopup();a.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){this._latlng=L.latLng(a);this.update();this._popup&&this._popup.setLatLng(a)},setZIndexOffset:function(a){this.options.zIndexOffset=a;this.update()},setIcon:function(a){this._map&&this._removeIcon();this.options.icon=a;this._map&&(this._initIcon(),this.update())},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();
this._setPos(a)}},_initIcon:function(){var a=this.options,b=this._map,b=b.options.zoomAnimation&&b.options.markerZoomAnimation?"leaflet-zoom-animated":"leaflet-zoom-hide",c=!1;this._icon||(this._icon=a.icon.createIcon(),a.title&&(this._icon.title=a.title),this._initInteraction(),c=1>this.options.opacity,L.DomUtil.addClass(this._icon,b));if(!this._shadow&&(this._shadow=a.icon.createShadow()))L.DomUtil.addClass(this._shadow,b),c=1>this.options.opacity;c&&this._updateOpacity();a=this._map._panes;a.markerPane.appendChild(this._icon);
this._shadow&&a.shadowPane.appendChild(this._shadow)},_removeIcon:function(){var a=this._map._panes;a.markerPane.removeChild(this._icon);this._shadow&&a.shadowPane.removeChild(this._shadow);this._icon=this._shadow=null},_setPos:function(a){L.DomUtil.setPosition(this._icon,a);this._shadow&&L.DomUtil.setPosition(this._shadow,a);this._icon.style.zIndex=a.y+this.options.zIndexOffset},_animateZoom:function(a){a=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);this._setPos(a)},_initInteraction:function(){if(this.options.clickable){var a=
this._icon,b=["dblclick","mousedown","mouseover","mouseout"];L.DomUtil.addClass(a,"leaflet-clickable");L.DomEvent.on(a,"click",this._onMouseClick,this);for(var c=0;c<b.length;c++)L.DomEvent.on(a,b[c],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(a){if(!this.dragging||!this.dragging.moved())(!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a})},
_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a});"mousedown"!==a.type&&"dblclick"!==a.type&&L.DomEvent.stopPropagation(a)},setOpacity:function(a){this.options.opacity=a;this._map&&this._updateOpacity()},_updateOpacity:function(){L.DomUtil.setOpacity(this._icon,this.options.opacity);this._shadow&&L.DomUtil.setOpacity(this._shadow,this.options.opacity)}});L.marker=function(a,b){return new L.Marker(a,b)};L.DivIcon=L.Icon.extend({options:{iconSize:new L.Point(12,12),className:"leaflet-div-icon"},createIcon:function(){var a=document.createElement("div"),b=this.options;b.html&&(a.innerHTML=b.html);b.bgPos&&(a.style.backgroundPosition=-b.bgPos.x+"px "+-b.bgPos.y+"px");this._setIconStyles(a,"icon");return a},createShadow:function(){return null}});L.divIcon=function(a){return new L.DivIcon(a)};L.Map.mergeOptions({closePopupOnClick:!0});
L.Popup=L.Class.extend({includes:L.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:!0,closeButton:!0,offset:new L.Point(0,6),autoPanPadding:new L.Point(5,5),className:""},initialize:function(a,b){L.Util.setOptions(this,a);this._source=b},onAdd:function(a){this._map=a;this._container||this._initLayout();this._updateContent();var b=a.options.fadeAnimation;b&&L.DomUtil.setOpacity(this._container,0);a._panes.popupPane.appendChild(this._container);a.on("viewreset",this._updatePosition,
this);if(L.Browser.any3d)a.on("zoomanim",this._zoomAnimation,this);if(a.options.closePopupOnClick)a.on("preclick",this._close,this);this._update();b&&L.DomUtil.setOpacity(this._container,1)},addTo:function(a){a.addLayer(this);return this},openOn:function(a){a.openPopup(this);return this},onRemove:function(a){a._panes.popupPane.removeChild(this._container);L.Util.falseFn(this._container.offsetWidth);a.off({viewreset:this._updatePosition,preclick:this._close,zoomanim:this._zoomAnimation},this);a.options.fadeAnimation&&
L.DomUtil.setOpacity(this._container,0);this._map=null},setLatLng:function(a){this._latlng=L.latLng(a);this._update();return this},setContent:function(a){this._content=a;this._update();return this},_close:function(){var a=this._map;a&&(a._popup=null,a.removeLayer(this).fire("popupclose",{popup:this}))},_initLayout:function(){var a=this._container=L.DomUtil.create("div","leaflet-popup "+this.options.className+" leaflet-zoom-animated"),b;this.options.closeButton&&(b=this._closeButton=L.DomUtil.create("a",
"leaflet-popup-close-button",a),b.href="#close",b.innerHTML="&#215;",L.DomEvent.on(b,"click",this._onCloseButtonClick,this));b=this._wrapper=L.DomUtil.create("div","leaflet-popup-content-wrapper",a);L.DomEvent.disableClickPropagation(b);this._contentNode=L.DomUtil.create("div","leaflet-popup-content",b);L.DomEvent.on(this._contentNode,"mousewheel",L.DomEvent.stopPropagation);this._tipContainer=L.DomUtil.create("div","leaflet-popup-tip-container",a);this._tip=L.DomUtil.create("div","leaflet-popup-tip",
this._tipContainer)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_updateContent:function(){if(this._content){if("string"===typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},
_updateLayout:function(){var a=this._contentNode,b=a.style;b.width="";b.whiteSpace="nowrap";var c=a.offsetWidth,c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth);b.width=c+1+"px";b.whiteSpace="";b.height="";var c=a.offsetHeight,d=this.options.maxHeight;d&&c>d?(b.height=d+"px",L.DomUtil.addClass(a,"leaflet-popup-scrolled")):L.DomUtil.removeClass(a,"leaflet-popup-scrolled");this._containerWidth=this._container.offsetWidth},_updatePosition:function(){var a=this._map.latLngToLayerPoint(this._latlng),
b=L.Browser.any3d,c=this.options.offset;b&&L.DomUtil.setPosition(this._container,a);this._containerBottom=-c.y-(b?0:a.y);this._containerLeft=-Math.round(this._containerWidth/2)+c.x+(b?0:a.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(a){a=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);L.DomUtil.setPosition(this._container,a)},_adjustPan:function(){if(this.options.autoPan){var a=this._map,b=this._container.offsetHeight,
c=this._containerWidth,d=new L.Point(this._containerLeft,-b-this._containerBottom);L.Browser.any3d&&d._add(L.DomUtil.getPosition(this._container));var d=a.layerPointToContainerPoint(d),e=this.options.autoPanPadding,f=a.getSize(),g=0,h=0;0>d.x&&(g=d.x-e.x);d.x+c>f.x&&(g=d.x+c-f.x+e.x);0>d.y&&(h=d.y-e.y);d.y+b>f.y&&(h=d.y+b-f.y+e.y);(g||h)&&a.panBy(new L.Point(g,h))}},_onCloseButtonClick:function(a){this._close();L.DomEvent.stop(a)}});L.popup=function(a,b){return new L.Popup(a,b)};L.Marker.include({openPopup:function(){this._popup&&this._map&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup));return this},closePopup:function(){this._popup&&this._popup._close();return this},bindPopup:function(a,b){var c=L.point(this.options.icon.options.popupAnchor)||new L.Point(0,0),c=c.add(L.Popup.prototype.options.offset);b&&b.offset&&(c=c.add(b.offset));b=L.Util.extend({offset:c},b);if(!this._popup)this.on("click",this.openPopup,this);this._popup=(new L.Popup(b,this)).setContent(a);
return this},unbindPopup:function(){this._popup&&(this._popup=null,this.off("click",this.openPopup));return this}});L.Map.include({openPopup:function(a){this.closePopup();this._popup=a;return this.addLayer(a).fire("popupopen",{popup:this._popup})},closePopup:function(){this._popup&&this._popup._close();return this}});L.LayerGroup=L.Class.extend({initialize:function(a){this._layers={};var b,c;if(a){b=0;for(c=a.length;b<c;b++)this.addLayer(a[b])}},addLayer:function(a){var b=L.Util.stamp(a);this._layers[b]=a;this._map&&this._map.addLayer(a);return this},removeLayer:function(a){var b=L.Util.stamp(a);delete this._layers[b];this._map&&this._map.removeLayer(a);return this},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(a){var b=Array.prototype.slice.call(arguments,1),c,d;for(c in this._layers)this._layers.hasOwnProperty(c)&&
(d=this._layers[c],d[a]&&d[a].apply(d,b));return this},onAdd:function(a){this._map=a;this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a);this._map=null},addTo:function(a){a.addLayer(this);return this},eachLayer:function(a,b){for(var c in this._layers)this._layers.hasOwnProperty(c)&&a.call(b,this._layers[c])}});L.layerGroup=function(a){return new L.LayerGroup(a)};L.FeatureGroup=L.LayerGroup.extend({includes:L.Mixin.Events,addLayer:function(a){if(this._layers[L.Util.stamp(a)])return this;a.on("click dblclick mouseover mouseout mousemove contextmenu",this._propagateEvent,this);L.LayerGroup.prototype.addLayer.call(this,a);this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent);return this},removeLayer:function(a){a.off("click dblclick mouseover mouseout mousemove contextmenu",this._propagateEvent,this);L.LayerGroup.prototype.removeLayer.call(this,a);
return this._popupContent?this.invoke("unbindPopup"):this},bindPopup:function(a){this._popupContent=a;return this.invoke("bindPopup",a)},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new L.LatLngBounds;this.eachLayer(function(b){a.extend(b instanceof L.Marker?b.getLatLng():b.getBounds())},this);return a},_propagateEvent:function(a){a.layer=a.target;
a.target=this;this.fire(a.type,a)}});L.featureGroup=function(a){return new L.FeatureGroup(a)};L.Path=L.Class.extend({includes:[L.Mixin.Events],statics:{CLIP_PADDING:L.Browser.mobile?Math.max(0,Math.min(0.5,(1280/Math.max(window.innerWidth,window.innerHeight)-1)/2)):0.5},options:{stroke:!0,color:"#0033ff",dashArray:null,weight:5,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0},initialize:function(a){L.Util.setOptions(this,a)},onAdd:function(a){this._map=a;this._container||(this._initElements(),this._initEvents());this.projectLatlngs();this._updatePath();this._container&&this._map._pathRoot.appendChild(this._container);
a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){a.addLayer(this);return this},onRemove:function(a){a._pathRoot.removeChild(this._container);this._map=null;L.Browser.vml&&(this._fill=this._stroke=this._container=null);a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){L.Util.setOptions(this,a);this._container&&this._updateStyle();return this},redraw:function(){this._map&&(this.projectLatlngs(),
this._updatePath());return this}});L.Map.include({_updatePathViewport:function(){var a=L.Path.CLIP_PADDING,b=this.getSize(),c=L.DomUtil.getPosition(this._mapPane).multiplyBy(-1)._subtract(b.multiplyBy(a)),a=c.add(b.multiplyBy(1+2*a));this._pathViewport=new L.Bounds(c,a)}});L.Path.SVG_NS="http://www.w3.org/2000/svg";L.Browser.svg=!(!document.createElementNS||!document.createElementNS(L.Path.SVG_NS,"svg").createSVGRect);
L.Path=L.Path.extend({statics:{SVG:L.Browser.svg},bringToFront:function(){this._container&&this._map._pathRoot.appendChild(this._container);return this},bringToBack:function(){if(this._container){var a=this._map._pathRoot;a.insertBefore(this._container,a.firstChild)}return this},getPathString:function(){},_createElement:function(a){return document.createElementNS(L.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=
this._createElement("g");this._path=this._createElement("path");this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round"));this.options.fill&&this._path.setAttribute("fill-rule","evenodd");this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",
this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray")):this._path.setAttribute("stroke","none");this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var a=this.getPathString();a||(a="M0 0");this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){(L.Browser.svg||
!L.Browser.vml)&&this._path.setAttribute("class","leaflet-clickable");L.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a="dblclick mousedown mouseover mouseout mousemove contextmenu".split(" "),b=0;b<a.length;b++)L.DomEvent.on(this._container,a[b],this._fireMouseEvent,this)}},_onMouseClick:function(a){(!this._map.dragging||!this._map.dragging.moved())&&this._fireMouseEvent(a)},_fireMouseEvent:function(a){if(this.hasEventListeners(a.type)){"contextmenu"===a.type&&L.DomEvent.preventDefault(a);
var b=this._map,c=b.mouseEventToContainerPoint(a),d=b.containerPointToLayerPoint(c),b=b.layerPointToLatLng(d);this.fire(a.type,{latlng:b,layerPoint:d,containerPoint:c,originalEvent:a})}}});
L.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=L.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&L.Browser.any3d?(this._pathRoot.setAttribute("class"," leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):this._pathRoot.setAttribute("class"," leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(a){var b=
this.getZoomScale(a.zoom),a=this._getCenterOffset(a.center).divideBy(1-1/b),a=this.containerPointToLayerPoint(this.getSize().multiplyBy(-L.Path.CLIP_PADDING)).add(a).round();this._pathRoot.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a.multiplyBy(-1).add(L.DomUtil.getPosition(this._pathRoot)).multiplyBy(b).add(a))+" scale("+b+") ";this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,
b=a.min,c=a.max,a=c.x-b.x,c=c.y-b.y,d=this._pathRoot,e=this._panes.overlayPane;L.Browser.mobileWebkit&&e.removeChild(d);L.DomUtil.setPosition(d,b);d.setAttribute("width",a);d.setAttribute("height",c);d.setAttribute("viewBox",[b.x,b.y,a,c].join(" "));L.Browser.mobileWebkit&&e.appendChild(d)}}});L.Path.include({bindPopup:function(a,b){if(!this._popup||this._popup.options!==b)this._popup=new L.Popup(b,this);this._popup.setContent(a);this._openPopupAdded||(this.on("click",this._openPopup,this),this._openPopupAdded=!0);return this},openPopup:function(a){this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a}));return this},_openPopup:function(a){this._popup.setLatLng(a.latlng);this._map.openPopup(this._popup)}});L.Browser.vml=function(){try{var a=document.createElement("div");a.innerHTML='<v:shape adj="1"/>';var b=a.firstChild;b.style.behavior="url(#default#VML)";return b&&"object"===typeof b.adj}catch(c){return!1}}();
L.Path=L.Browser.svg||!L.Browser.vml?L.Path:L.Path.extend({statics:{VML:!0,CLIP_PADDING:0.02},_createElement:function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(a){return document.createElement("<lvml:"+a+' class="lvml">')}}catch(a){return function(a){return document.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var a=this._container=this._createElement("shape");L.DomUtil.addClass(a,"leaflet-vml-shape");
this.options.clickable&&L.DomUtil.addClass(a,"leaflet-clickable");a.coordsize="1 1";this._path=this._createElement("path");a.appendChild(this._path);this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var a=this._stroke,b=this._fill,c=this.options,d=this._container;d.stroked=c.stroke;d.filled=c.fill;c.stroke?(a||(a=this._stroke=this._createElement("stroke"),a.endcap="round",d.appendChild(a)),a.weight=c.weight+"px",a.color=c.color,a.opacity=c.opacity,
a.dashStyle=c.dashArray?c.dashArray.replace(/ *, */g," "):""):a&&(d.removeChild(a),this._stroke=null);c.fill?(b||(b=this._fill=this._createElement("fill"),d.appendChild(b)),b.color=c.fillColor||c.color,b.opacity=c.fillOpacity):b&&(d.removeChild(b),this._fill=null)},_updatePath:function(){var a=this._container.style;a.display="none";this._path.v=this.getPathString()+" ";a.display=""}});
L.Map.include(L.Browser.svg||!L.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=document.createElement("div");a.className="leaflet-vml-container";this._panes.overlayPane.appendChild(a);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}}});L.Browser.canvas=function(){return!!document.createElement("canvas").getContext}();
L.Path=L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?L.Path:L.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){this._map&&(this.projectLatlngs(),this._requestUpdate());return this},setStyle:function(a){L.Util.setOptions(this,a);this._map&&(this._updateStyle(),this._requestUpdate());return this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);this._requestUpdate();this._map=null},_requestUpdate:function(){this._map&&(L.Util.cancelAnimFrame(this._fireMapMoveEnd),
this._updateRequest=L.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color);a.fill&&(this._ctx.fillStyle=a.fillColor||a.color)},_drawPath:function(){var a,b,c,d,e,f;this._ctx.beginPath();a=0;for(c=this._parts.length;a<c;a++){b=0;for(d=this._parts[a].length;b<
d;b++)e=this._parts[a][b],f=(0===b?"move":"line")+"To",this._ctx[f](e.x,e.y);this instanceof L.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,b=this.options;this._drawPath();a.save();this._updateStyle();b.fill&&(1>b.fillOpacity&&(a.globalAlpha=b.fillOpacity),a.fill());b.stroke&&(1>b.opacity&&(a.globalAlpha=b.opacity),a.stroke());a.restore()}},_initEvents:function(){if(this.options.clickable){for(var a=
"dblclick mousedown mouseover mouseout mousemove contextmenu".split(" "),b=0;b<a.length;b++)this._map.on(a[b],this._fireMouseEvent,this);this._map.on("click",this._onClick,this)}},_fireMouseEvent:function(a){this._containsPoint(a.layerPoint)&&(a.layer=this,this.fire(a.type,a));L.DomEvent.stopPropagation(a)},_onClick:function(a){this._containsPoint(a.layerPoint)&&this.fire("click",{latlng:a.latlng,layerPoint:a.layerPoint,containerPoint:a.containerPoint,originalEvent:a})}});
L.Map.include(L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?{}:{_initPathRoot:function(){var a=this._pathRoot,b;a||(a=this._pathRoot=document.createElement("canvas"),a.style.position="absolute",b=this._canvasCtx=a.getContext("2d"),b.lineCap="round",b.lineJoin="round",this._panes.overlayPane.appendChild(a),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),
this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,a=a.max.subtract(b),c=this._pathRoot;L.DomUtil.setPosition(c,b);c.width=a.x;c.height=a.y;c.getContext("2d").translate(-b.x,-b.y)}}});L.LineUtil={simplify:function(a,b){if(!b||!a.length)return a.slice();var c=b*b,a=this._reducePoints(a,c);return a=this._simplifyDP(a,c)},pointToSegmentDistance:function(a,b,c){return Math.sqrt(this._sqClosestPointOnSegment(a,b,c,!0))},closestPointOnSegment:function(a,b,c){return this._sqClosestPointOnSegment(a,b,c)},_simplifyDP:function(a,b){var c=a.length,d=new ("undefined"!==typeof Uint8Array?Uint8Array:Array)(c);d[0]=d[c-1]=1;this._simplifyDPStep(a,d,b,0,c-1);var e,f=[];for(e=0;e<c;e++)d[e]&&f.push(a[e]);
return f},_simplifyDPStep:function(a,b,c,d,e){var f=0,g,h,i;for(h=d+1;h<=e-1;h++)i=this._sqClosestPointOnSegment(a[h],a[d],a[e],!0),i>f&&(g=h,f=i);f>c&&(b[g]=1,this._simplifyDPStep(a,b,c,d,g),this._simplifyDPStep(a,b,c,g,e))},_reducePoints:function(a,b){for(var c=[a[0]],d=1,e=0,f=a.length;d<f;d++)this._sqDist(a[d],a[e])>b&&(c.push(a[d]),e=d);e<f-1&&c.push(a[f-1]);return c},clipSegment:function(a,b,c,d){var d=d?this._lastCode:this._getBitCode(a,c),e=this._getBitCode(b,c);for(this._lastCode=e;;)if(d|
e){if(d&e)return!1;var f=d||e,g=this._getEdgeIntersection(a,b,f,c),h=this._getBitCode(g,c);f===d?(a=g,d=h):(b=g,e=h)}else return[a,b]},_getEdgeIntersection:function(a,b,c,d){var e=b.x-a.x,b=b.y-a.y,f=d.min,d=d.max;if(c&8)return new L.Point(a.x+e*(d.y-a.y)/b,d.y);if(c&4)return new L.Point(a.x+e*(f.y-a.y)/b,f.y);if(c&2)return new L.Point(d.x,a.y+b*(d.x-a.x)/e);if(c&1)return new L.Point(f.x,a.y+b*(f.x-a.x)/e)},_getBitCode:function(a,b){var c=0;a.x<b.min.x?c|=1:a.x>b.max.x&&(c|=2);a.y<b.min.y?c|=4:a.y>
b.max.y&&(c|=8);return c},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},_sqClosestPointOnSegment:function(a,b,c,d){var e=b.x,b=b.y,f=c.x-e,g=c.y-b,h=f*f+g*g;0<h&&(h=((a.x-e)*f+(a.y-b)*g)/h,1<h?(e=c.x,b=c.y):0<h&&(e+=f*h,b+=g*h));f=a.x-e;g=a.y-b;return d?f*f+g*g:new L.Point(e,b)}};L.Polyline=L.Path.extend({initialize:function(a,b){L.Path.prototype.initialize.call(this,b);this._latlngs=this._convertLatLngs(a);L.Handler.PolyEdit&&(this.editing=new L.Handler.PolyEdit(this),this.options.editable&&this.editing.enable())},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;a<b;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getPathString:function(){for(var a=0,b=this._parts.length,c="";a<
b;a++)c+=this._getPathPartStr(this._parts[a]);return c},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){this._latlngs=this._convertLatLngs(a);return this.redraw()},addLatLng:function(a){this._latlngs.push(L.latLng(a));return this.redraw()},spliceLatLngs:function(a,b){var c=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs);this.redraw();return c},closestLayerPoint:function(a){for(var b=Infinity,c=this._parts,d,e,f=null,g=0,h=c.length;g<h;g++)for(var i=
c[g],j=1,k=i.length;j<k;j++){d=i[j-1];e=i[j];var l=L.LineUtil._sqClosestPointOnSegment(a,d,e,!0);l<b&&(b=l,f=L.LineUtil._sqClosestPointOnSegment(a,d,e))}f&&(f.distance=Math.sqrt(b));return f},getBounds:function(){for(var a=new L.LatLngBounds,b=this.getLatLngs(),c=0,d=b.length;c<d;c++)a.extend(b[c]);return a},getCenter:function(){var a=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b=function(a,b,c){var d=Math.abs(a.x-b.x),e=Math.abs(a.y-b.y),f=b.x-a.x,b=b.y-a.y,c=Math.sqrt(Math.pow(d,
2)+Math.pow(e,2))/c;return{x:a.x+f/c,y:a.y+b/c}},c=0,d=0,e=0,f,g,d=this.getLatLngs(),h,i=[this._map.project(d[0])];g=d.length;for(f=1;f<g;f++)h=this._map.project(d[f]),c+=a(i[f-1],h),i.push(h);d=c/2;for(f=1;f<g;f++){h=i[f];c=a(i[f-1],h);if(e+c>d)return this._map.unproject(b(i[f-1],h,d-e));e+=c}return this._map.unproject(i[0])},onAdd:function(a){L.Path.prototype.onAdd.call(this,a);this.editing&&this.editing.enabled()&&this.editing.addHooks()},onRemove:function(a){this.editing&&this.editing.enabled()&&
this.editing.removeHooks();L.Path.prototype.onRemove.call(this,a)},_convertLatLngs:function(a){var b,c;b=0;for(c=a.length;b<c;b++){if(a[b]instanceof Array&&"number"!==typeof a[b][0])return;a[b]=L.latLng(a[b])}return a},_initEvents:function(){L.Path.prototype._initEvents.call(this)},_getPathPartStr:function(a){for(var b=L.Path.VML,c=[],d=0,e=a.length,f;d<e;d++)f=a[d],b&&f._round(),c.push(f.x+" "+f.y);2==c.length&&c[0]==c[1]&&(a=c[0].split(" "),c=c[1].split(" "),c=[""+(parseFloat(a[0])-1)+" "+(parseFloat(a[1])-
1)+"",""+(parseFloat(c[0])+1)+" "+(parseFloat(c[1])+1)+""]);return"M"+c.join("L")},_clipPoints:function(){var a=this._originalPoints,b=a.length,c,d,e;if(this.options.noClip)this._parts=[a];else{var f=this._parts=[],g=this._map._pathViewport,h=L.LineUtil;for(d=c=0;c<b-1;c++)if(e=h.clipSegment(a[c],a[c+1],g,c))if(f[d]=f[d]||[],f[d].push(e[0]),e[1]!==a[c+1]||c===b-2)f[d].push(e[1]),d++}},_simplifyPoints:function(){for(var a=this._parts,b=L.LineUtil,c=0,d=a.length;c<d;c++)a[c]=b.simplify(a[c],this.options.smoothFactor)},
_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),L.Path.prototype._updatePath.call(this))}});L.polyline=function(a,b){return new L.Polyline(a,b)};L.PolyUtil={};L.PolyUtil.clipPolygon=function(a,b){var c,d=[1,4,2,8],e,f,g,h,i,j,k=L.LineUtil;e=0;for(i=a.length;e<i;e++)a[e]._code=k._getBitCode(a[e],b);for(g=0;4>g;g++){j=d[g];c=[];e=0;i=a.length;for(f=i-1;e<i;f=e++)h=a[e],f=a[f],h._code&j?f._code&j||(f=k._getEdgeIntersection(f,h,j,b),f._code=k._getBitCode(f,b),c.push(f)):(f._code&j&&(f=k._getEdgeIntersection(f,h,j,b),f._code=k._getBitCode(f,b),c.push(f)),c.push(h));a=c}return a};L.Polygon=L.Polyline.extend({options:{fill:!0},initialize:function(a,b){L.Polyline.prototype.initialize.call(this,a,b);a&&(a[0]instanceof Array&&"number"!==typeof a[0][0])&&(this._latlngs=this._convertLatLngs(a[0]),this._holes=a.slice(1))},getArea:function(){var a=0,b,c,d,e=this.getLatLngs(),f=e.length;for(d=0;d<f-1;d++)b=e[d],c=e[d+1],a+=(b.lng+c.lng)*(c.lat-b.lat);return-a/2},getCentroid:function(){var a=this.getLatLngs(),b=0,c=0,d,e,f;if(!a||3>a.length)return null;var g=a.length;for(f=0;f<g-1;f++)d=
a[f],e=a[f+1],b+=(d.lng+e.lng)*(d.lng*e.lat-e.lng*d.lat),c+=(d.lat+e.lat)*(d.lng*e.lat-e.lng*d.lat);a=-1*this.getArea();return new L.LatLng(c/(6*a),b/(6*a))},projectLatlngs:function(){L.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(this._holes)for(var a=0,b=this._holes.length;a<b;a++){this._holePoints[a]=[];for(var c=0,d=this._holes[a].length;c<d;c++)this._holePoints[a][c]=this._map.latLngToLayerPoint(this._holes[a][c])}},_clipPoints:function(){var a=[];this._parts=[this._originalPoints].concat(this._holePoints);
if(!this.options.noClip){for(var b=0,c=this._parts.length;b<c;b++){var d=L.PolyUtil.clipPolygon(this._parts[b],this._map._pathViewport);d.length&&a.push(d)}this._parts=a}},_getPathPartStr:function(a){return L.Polyline.prototype._getPathPartStr.call(this,a)+(L.Browser.svg?"z":"x")}});L.polygon=function(a,b){return new L.Polygon(a,b)};(function(){function a(a){return L.FeatureGroup.extend({initialize:function(a,b){this._layers={};this._options=b;this.setLatLngs(a)},setLatLngs:function(c){var d=0,e=c.length;for(this.eachLayer(function(a){d<e?a.setLatLngs(c[d++]):this.removeLayer(a)},this);d<e;)this.addLayer(new a(c[d++],this._options));return this}})}L.MultiPolyline=a(L.Polyline);L.MultiPolygon=a(L.Polygon);L.multiPolyline=function(a,c){return new L.MultiPolyline(a,c)};L.multiPolygon=function(a,c){return new L.MultiPolygon(a,c)}})();L.Rectangle=L.Polygon.extend({initialize:function(a,b){L.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),b)},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){a=L.latLngBounds(a);return[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast(),a.getSouthWest()]}});L.rectangle=function(a,b){return new L.Rectangle(a,b)};L.Circle=L.Path.extend({initialize:function(a,b,c){L.Path.prototype.initialize.call(this,c);this._latlng=L.latLng(a);this._mRadius=b},options:{fill:!0},setLatLng:function(a){this._latlng=L.latLng(a);return this.redraw()},setRadius:function(a){this._mRadius=a;return this.redraw()},projectLatlngs:function(){var a=this._getLngRadius(),a=new L.LatLng(this._latlng.lat,this._latlng.lng-a,!0),a=this._map.latLngToLayerPoint(a);this._point=this._map.latLngToLayerPoint(this._latlng);this._radius=Math.max(Math.round(this._point.x-
a.x),1)},getBounds:function(){var a=this._map,b=this._radius*Math.cos(Math.PI/4),c=a.project(this._latlng),d=new L.Point(c.x-b,c.y+b),b=new L.Point(c.x+b,c.y-b),d=a.unproject(d),a=a.unproject(b);return new L.LatLngBounds(d,a)},getLatLng:function(){return this._latlng},getPathString:function(){var a=this._point,b=this._radius;if(this._checkIfEmpty())return"";if(L.Browser.svg)return"M"+a.x+","+(a.y-b)+"A"+b+","+b+",0,1,1,"+(a.x-0.1)+","+(a.y-b)+" z";a._round();b=Math.round(b);return"AL "+a.x+","+a.y+
" "+b+","+b+" 0,23592600"},getRadius:function(){return this._mRadius},_getLngRadius:function(){var a=40075017*Math.cos(L.LatLng.DEG_TO_RAD*this._latlng.lat);return 360*(this._mRadius/a)},_checkIfEmpty:function(){if(!this._map)return!1;var a=this._map._pathViewport,b=this._radius,c=this._point;return c.x-b>a.max.x||c.y-b>a.max.y||c.x+b<a.min.x||c.y+b<a.min.y}});L.circle=function(a,b,c){return new L.Circle(a,b,c)};L.CircleMarker=L.Circle.extend({options:{radius:10,weight:2},initialize:function(a,b){L.Circle.prototype.initialize.call(this,a,null,b);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},setRadius:function(a){this._radius=a;return this.redraw()}});L.circleMarker=function(a,b){return new L.CircleMarker(a,b)};L.Polyline.include(!L.Path.CANVAS?{}:{_containsPoint:function(a,b){var c,d,e,f,g,h,i=this.options.weight/2;L.Browser.touch&&(i+=10);c=0;for(f=this._parts.length;c<f;c++){h=this._parts[c];d=0;g=h.length;for(e=g-1;d<g;e=d++)if(b||0!==d)if(e=L.LineUtil.pointToSegmentDistance(a,h[e],h[d]),e<=i)return!0}return!1}});L.Polygon.include(!L.Path.CANVAS?{}:{_containsPoint:function(a){var b=!1,c,d,e,f,g,h,i;if(L.Polyline.prototype._containsPoint.call(this,a,!0))return!0;f=0;for(h=this._parts.length;f<h;f++){c=this._parts[f];g=0;i=c.length;for(e=i-1;g<i;e=g++)d=c[g],e=c[e],d.y>a.y!==e.y>a.y&&a.x<(e.x-d.x)*(a.y-d.y)/(e.y-d.y)+d.x&&(b=!b)}return b}});L.Circle.include(!L.Path.CANVAS?{}:{_drawPath:function(){var a=this._point;this._ctx.beginPath();this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(a){var b=this.options.stroke?this.options.weight/2:0;return a.distanceTo(this._point)<=this._radius+b}});L.GeoJSON=L.FeatureGroup.extend({initialize:function(a,b){L.Util.setOptions(this,b);this._layers={};a&&this.addData(a)},addData:function(a){var b=a instanceof Array?a:a.features,c;if(b){a=0;for(c=b.length;a<c;a++)this.addData(b[a]);return this}b=this.options;if(!b.filter||b.filter(a)){c=L.GeoJSON.geometryToLayer(a,b.pointToLayer);c.feature=a;this.resetStyle(c);if(b.onEachFeature)b.onEachFeature(a,c);return this.addLayer(c)}},resetStyle:function(a){var b=this.options.style;b&&this._setLayerStyle(a,
b)},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"===typeof b&&(b=b(a.feature));a.setStyle&&a.setStyle(b)}});
L.Util.extend(L.GeoJSON,{geometryToLayer:function(a,b){var c="Feature"===a.type?a.geometry:a,d=c.coordinates,e=[],f,g,h;switch(c.type){case "Point":return c=this.coordsToLatLng(d),b?b(a,c):new L.Marker(c);case "MultiPoint":f=0;for(g=d.length;f<g;f++)c=this.coordsToLatLng(d[f]),h=b?b(a,c):new L.Marker(c),e.push(h);return new L.FeatureGroup(e);case "LineString":return d=this.coordsToLatLngs(d),new L.Polyline(d);case "Polygon":return d=this.coordsToLatLngs(d,1),new L.Polygon(d);case "MultiLineString":return d=
this.coordsToLatLngs(d,1),new L.MultiPolyline(d);case "MultiPolygon":return d=this.coordsToLatLngs(d,2),new L.MultiPolygon(d);case "GeometryCollection":f=0;for(g=c.geometries.length;f<g;f++)h=this.geometryToLayer(c.geometries[f],b),e.push(h);return new L.FeatureGroup(e);default:throw Error("Invalid GeoJSON object.");}},coordsToLatLng:function(a,b){var c=parseFloat(a[b?0:1]),d=parseFloat(a[b?1:0]);return new L.LatLng(c,d,!0)},coordsToLatLngs:function(a,b,c){var d,e=[],f,g;f=0;for(g=a.length;f<g;f++)d=
b?this.coordsToLatLngs(a[f],b-1,c):this.coordsToLatLng(a[f],c),e.push(d);return e}});L.geoJson=function(a,b){return new L.GeoJSON(a,b)};L.DomEvent={addListener:function(a,b,c,d){var e=L.Util.stamp(c),f="_leaflet_"+b+e,g,h;if(a[f])return this;g=function(b){return c.call(d||a,b||L.DomEvent._getEvent())};if(L.Browser.msTouch&&0===b.indexOf("touch"))return this.addMsTouchListener(a,b,g,e);if(L.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener)return this.addDoubleTapListener(a,g,e);"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",g,!1),a.addEventListener(b,g,!1)):"mouseenter"===b||"mouseleave"===b?(h=
g,g=function(b){if(L.DomEvent._checkMouse(a,b))return h(b)},a.addEventListener("mouseenter"===b?"mouseover":"mouseout",g,!1)):a.addEventListener(b,g,!1):"attachEvent"in a&&a.attachEvent("on"+b,g);a[f]=g;return this},removeListener:function(a,b,c){var c=L.Util.stamp(c),d="_leaflet_"+b+c,e=a[d];if(e)return L.Browser.msTouch&&0===b.indexOf("touch")?this.removeMsTouchListener(a,b,c):L.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,c):"removeEventListener"in
a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",e,!1),a.removeEventListener(b,e,!1)):"mouseenter"===b||"mouseleave"===b?a.removeEventListener("mouseenter"===b?"mouseover":"mouseout",e,!1):a.removeEventListener(b,e,!1):"detachEvent"in a&&a.detachEvent("on"+b,e),a[d]=null,this},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return this},disableClickPropagation:function(a){var b=L.DomEvent.stopPropagation;return L.DomEvent.addListener(a,L.Draggable.START,
b).addListener(a,"click",b).addListener(a,"dblclick",b)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;return this},stop:function(a){return L.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(a,b){var c=document.body,d=document.documentElement,c=new L.Point(a.pageX?a.pageX:a.clientX+c.scrollLeft+d.scrollLeft,a.pageY?a.pageY:a.clientY+c.scrollTop+d.scrollTop);return b?c._subtract(L.DomUtil.getViewportOffset(b)):c},getWheelDelta:function(a){var b=
0;a.wheelDelta&&(b=a.wheelDelta/120);a.detail&&(b=-a.detail/3);return b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_getEvent:function(){var a=window.event;if(!a)for(var b=arguments.callee.caller;b&&!((a=b.arguments[0])&&window.Event===a.constructor);)b=b.caller;return a}};L.DomEvent.on=L.DomEvent.addListener;L.DomEvent.off=L.DomEvent.removeListener;L.Draggable=L.Class.extend({includes:L.Mixin.Events,statics:{START:L.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"},TAP_TOLERANCE:15},initialize:function(a,b,c,d){this._element=a;this._dragStartTarget=b||a;this._longPress=c&&!L.Browser.msTouch;this.buffer=d||0},enable:function(){if(!this._enabled){for(var a=L.Draggable.START.length-1;0<=a;a--)L.DomEvent.on(this._dragStartTarget,
L.Draggable.START[a],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var a=L.Draggable.START.length-1;0<=a;a--)L.DomEvent.off(this._dragStartTarget,L.Draggable.START[a],this._onDown,this);this._moved=this._enabled=!1}},_onDown:function(a){if(!(!L.Browser.touch&&a.shiftKey||1!==a.which&&1!==a.button&&!a.touches))if(L.DomEvent.preventDefault(a),L.DomEvent.stopPropagation(a),!L.Draggable._disabled)if(this._simulateClick=!0,a.touches&&1<a.touches.length)this._simulateClick=
!1,clearTimeout(this._longPressTimeout);else{var b=a.touches&&1===a.touches.length?a.touches[0]:a,c=b.target;L.Browser.touch&&"a"===c.tagName.toLowerCase()&&L.DomUtil.addClass(c,"leaflet-active");this._moved=!1;this._moving||(this._startPoint=new L.Point(b.clientX,b.clientY),this._startPos=this._newPos=L.DomUtil.getPosition(this._element),a.touches&&(1===a.touches.length&&L.Browser.touch&&this._longPress)&&(this._longPressTimeout=setTimeout(L.bind(function(){if((this._newPos&&this._newPos.distanceTo(this._startPos)||
0)<L.Draggable.TAP_TOLERANCE)this._simulateClick=!1,this._onUp(),this._simulateEvent("contextmenu",b)},this),1E3)),L.DomEvent.on(document,L.Draggable.MOVE[a.type],this._onMove,this),L.DomEvent.on(document,L.Draggable.END[a.type],this._onUp,this))}},_onMove:function(a){if(!(a.touches&&1<a.touches.length)){var b=a.touches&&1===a.touches.length?a.touches[0]:a,b=(new L.Point(b.clientX,b.clientY)).subtract(this._startPoint);if(b.x||b.y){L.DomEvent.preventDefault(a);if(!this._moved){if(this.buffer&&b.distanceTo([0,
0])<this.buffer)return;this.fire("dragstart");this._moved=!0;this._startPos=L.DomUtil.getPosition(this._element).subtract(b);L.Browser.touch||(L.DomUtil.disableTextSelection(),this._setMovingCursor())}this._newPos=this._startPos.add(b);this._moving=!0;L.Util.cancelAnimFrame(this._animRequest);this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)}}},_updatePosition:function(){this.fire("predrag");L.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},
_onUp:function(a){var b;clearTimeout(this._longPressTimeout);if(this._simulateClick&&a.changedTouches){var a=a.changedTouches[0],c=a.target,d=this._newPos&&this._newPos.distanceTo(this._startPos)||0;"a"===c.tagName.toLowerCase()&&L.DomUtil.removeClass(c,"leaflet-active");d<L.Draggable.TAP_TOLERANCE&&(b=a)}L.Browser.touch||(L.DomUtil.enableTextSelection(),this._restoreCursor());for(var e in L.Draggable.MOVE)L.Draggable.MOVE.hasOwnProperty(e)&&(L.DomEvent.off(document,L.Draggable.MOVE[e],this._onMove),
L.DomEvent.off(document,L.Draggable.END[e],this._onUp));this._moved&&(L.Util.cancelAnimFrame(this._animRequest),this.fire("dragend"));this._moving=!1;b&&(this._moved=!1,this._simulateEvent("click",b))},_setMovingCursor:function(){L.DomUtil.addClass(document.body,"leaflet-dragging")},_restoreCursor:function(){L.DomUtil.removeClass(document.body,"leaflet-dragging")},_simulateEvent:function(a,b){var c=document.createEvent("MouseEvents");c.initMouseEvent(a,!0,!0,window,1,b.screenX,b.screenY,b.clientX,
b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(c)}});L.Handler=L.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}});L.Map.mergeOptions({dragging:!0,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:L.Browser.touch?32:18,easeLinearity:0.25,longPress:!0,worldCopyJump:!1});
L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new L.Draggable(a._mapPane,a._container,a.options.longPress);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},
_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop();a.fire("movestart").fire("dragstart");a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,b=this._lastPos=this._draggable._newPos;this._positions.push(b);this._times.push(a);200<a-this._times[0]&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var a=this._map.getSize()._divideBy(2);this._initialWorldOffset=
this._map.latLngToLayerPoint(new L.LatLng(0,0)).subtract(a).x;this._worldWidth=this._map.project(new L.LatLng(0,180)).x},_onPreDrag:function(){var a=this._worldWidth,b=Math.round(a/2),c=this._initialWorldOffset,d=this._draggable._newPos.x,e=(d-b+c)%a+b-c,a=(d+b+c)%a-b-c,c=Math.abs(e+c)<Math.abs(a+c)?e:a;this._draggable._newPos.x=c},_onDragEnd:function(){var a=this._map,b=a.options,c=+new Date-this._lastTime;if(!b.inertia||c>b.inertiaThreshold||!this._positions[0])a.fire("moveend");else{var d=this._lastPos.subtract(this._positions[0]),
e=b.easeLinearity,d=d.multiplyBy(e/((this._lastTime+c-this._times[0])/1E3)),f=d.distanceTo(new L.Point(0,0)),c=Math.min(b.inertiaMaxSpeed,f),d=d.multiplyBy(c/f),g=c/(b.inertiaDeceleration*e),h=d.multiplyBy(-g/2).round();L.Util.requestAnimFrame(function(){a.panBy(h,g,e)})}a.fire("dragend");b.maxBounds&&L.Util.requestAnimFrame(this._panInsideMaxBounds,a,!0,a._container)},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)}});L.Map.addInitHook("addHandler","dragging",L.Map.Drag);L.Map.mergeOptions({doubleClickZoom:!0});L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick)},_onDoubleClick:function(a){this.setView(a.latlng,this._zoom+1)}});L.Map.addInitHook("addHandler","doubleClickZoom",L.Map.DoubleClickZoom);L.Map.mergeOptions({scrollWheelZoom:!L.Browser.touch});
L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);this._delta=0},removeHooks:function(){L.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll)},_onWheelScroll:function(a){var b=L.DomEvent.getWheelDelta(a);this._delta+=b;this._lastMousePos=this._map.mouseEventToContainerPoint(a);clearTimeout(this._timer);this._timer=setTimeout(L.Util.bind(this._performZoom,this),40);L.DomEvent.preventDefault(a)},_performZoom:function(){var a=
this._map,b=Math.round(this._delta),c=a.getZoom(),b=Math.max(Math.min(b,4),-4),b=a._limitZoom(c+b)-c;this._delta=0;b&&(b=c+b,c=this._getCenterForScrollWheelZoom(this._lastMousePos,b),a.setView(c,b))},_getCenterForScrollWheelZoom:function(a,b){var c=this._map,d=c.getZoomScale(b),e=c.getSize().divideBy(2),d=a.subtract(e).multiplyBy(1-1/d),e=c._getTopLeftPoint().add(e).add(d);return c.unproject(e)}});L.Map.addInitHook("addHandler","scrollWheelZoom",L.Map.ScrollWheelZoom);L.Map.mergeOptions({boxZoom:!0});
L.Map.BoxZoom=L.Handler.extend({initialize:function(a){this._map=a;this._container=a._container;this._pane=a._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){L.DomEvent.off(this._container,"mousedown",this._onMouseDown)},_onMouseDown:function(a){if(!a.shiftKey||1!==a.which&&1!==a.button)return!1;L.DomUtil.disableTextSelection();this._startLayerPoint=this._map.mouseEventToLayerPoint(a);this._box=L.DomUtil.create("div",
"leaflet-zoom-box",this._pane);L.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";L.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).preventDefault(a);this._map.fire("boxzoomstart")},_onMouseMove:function(a){var b=this._startLayerPoint,c=this._box,d=this._map.mouseEventToLayerPoint(a),a=d.subtract(b),b=new L.Point(Math.min(d.x,b.x),Math.min(d.y,b.y));L.DomUtil.setPosition(c,b);c.style.width=Math.abs(a.x)-
4+"px";c.style.height=Math.abs(a.y)-4+"px"},_onMouseUp:function(a){this._pane.removeChild(this._box);this._container.style.cursor="";L.DomUtil.enableTextSelection();L.DomEvent.off(document,"mousemove",this._onMouseMove).off(document,"mouseup",this._onMouseUp);var b=this._map,a=b.mouseEventToLayerPoint(a),a=new L.LatLngBounds(b.layerPointToLatLng(this._startLayerPoint),b.layerPointToLatLng(a));b.fitBounds(a);b.fire("boxzoomend",{boxZoomBounds:a})}});L.Map.addInitHook("addHandler","boxZoom",L.Map.BoxZoom);L.extend(L.DomEvent,{_touchstart:L.Browser.msTouch?"MSPointerDown":"touchstart",_touchend:L.Browser.msTouch?"MSPointerUp":"touchend",addDoubleTapListener:function(a,b,c){function d(a){var b;L.Browser.msTouch?(l.push(a.pointerId),b=l.length):b=a.touches.length;if(!(1<b)){b=Date.now();var c=b-(f||b);i=a.touches?a.touches[0]:a;g=0<c&&c<=h;f=b}}function e(a){if(L.Browser.msTouch){a=l.indexOf(a.pointerId);if(-1===a)return;l.splice(a,1)}if(g){if(L.Browser.msTouch){var a={},c,d;for(d in i)c=i[d],a[d]="function"===
typeof c?c.bind(i):c;i=a}i.type="dblclick";b(i);f=null}}var f,g=!1,h=250,i,j=this._touchstart,k=this._touchend,l=[];a["_leaflet_"+j+c]=d;a["_leaflet_"+k+c]=e;c=L.Browser.msTouch?document.documentElement:a;a.addEventListener(j,d,!1);c.addEventListener(k,e,!1);L.Browser.msTouch&&c.addEventListener("MSPointerCancel",e,!1);return this},removeDoubleTapListener:function(a,b){a.removeEventListener(this._touchstart,a["_leaflet_"+this._touchstart+b],!1);(L.Browser.msTouch?document.documentElement:a).removeEventListener(this._touchend,
a["_leaflet_"+this._touchend+b],!1);L.Browser.msTouch&&document.documentElement.removeEventListener("MSPointerCancel",a["_leaflet_"+this._touchend+b],!1);return this}});L.extend(L.DomEvent,{_msTouches:[],_msDocumentListener:!1,addMsTouchListener:function(a,b,c,d){switch(b){case "touchstart":return this.addMsTouchListenerStart(a,b,c,d);case "touchend":return this.addMsTouchListenerEnd(a,b,c,d);case "touchmove":return this.addMsTouchListenerMove(a,b,c,d);default:throw"Unknown touch event type";}},addMsTouchListenerStart:function(a,b,c,d){var e=this._msTouches,b=function(a){for(var b=!1,d=0;d<e.length;d++)if(e[d].pointerId===a.pointerId){b=!0;break}b||e.push(a);a.touches=
e.slice();a.changedTouches=[a];c(a)};a["_leaflet_touchstart"+d]=b;a.addEventListener("MSPointerDown",b,!1);this._msDocumentListener||(a=function(a){for(var b=0;b<e.length;b++)if(e[b].pointerId===a.pointerId){e.splice(b,1);break}},document.documentElement.addEventListener("MSPointerUp",a,!1),document.documentElement.addEventListener("MSPointerCancel",a,!1),this._msDocumentListener=!0);return this},addMsTouchListenerMove:function(a,b,c,d){function e(a){if(!(a.pointerType===a.MSPOINTER_TYPE_MOUSE&&0===
a.buttons)){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f[b]=a;break}a.touches=f.slice();a.changedTouches=[a];c(a)}}var f=this._msTouches;a["_leaflet_touchmove"+d]=e;a.addEventListener("MSPointerMove",e,!1);return this},addMsTouchListenerEnd:function(a,b,c,d){var e=this._msTouches,b=function(a){for(var b=0;b<e.length;b++)if(e[b].pointerId===a.pointerId){e.splice(b,1);break}a.touches=e.slice();a.changedTouches=[a];c(a)};a["_leaflet_touchend"+d]=b;a.addEventListener("MSPointerUp",b,
!1);a.addEventListener("MSPointerCancel",b,!1);return this},removeMsTouchListener:function(a,b,c){c=a["_leaflet_"+b+c];switch(b){case "touchstart":a.removeEventListener("MSPointerDown",c,!1);break;case "touchmove":a.removeEventListener("MSPointerMove",c,!1);break;case "touchend":a.removeEventListener("MSPointerUp",c,!1),a.removeEventListener("MSPointerCancel",c,!1)}return this}});L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23});
L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(a){var b=this._map;if(a.touches&&!(2!==a.touches.length||b._animatingZoom||this._zooming)){var c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]),b=b._getCenterLayerPoint();this._startCenter=c.add(d).divideBy(2,!0);this._startDist=
c.distanceTo(d);this._moved=!1;this._zooming=!0;this._centerOffset=b.subtract(this._startCenter);L.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this);L.DomEvent.preventDefault(a)}},_onTouchMove:function(a){if(a.touches&&2===a.touches.length){var b=this._map,c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]);this._scale=c.distanceTo(d)/this._startDist;this._delta=c.add(d).divideBy(2,!0).subtract(this._startCenter);1!==
this._scale&&(this._moved||(L.DomUtil.addClass(b._mapPane,"leaflet-zoom-anim leaflet-touching"),b.fire("movestart").fire("zoomstart")._prepareTileBg(),this._moved=!0),L.Util.cancelAnimFrame(this._animRequest),this._animRequest=L.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),L.DomEvent.preventDefault(a))}},_updateOnMove:function(){var a=this._map,b=this._getScaleOrigin(),b=a.layerPointToLatLng(b);a.fire("zoomanim",{center:b,zoom:a.getScaleZoom(this._scale)});a._tileBg.style[L.DomUtil.TRANSFORM]=
L.DomUtil.getTranslateString(this._delta)+" "+L.DomUtil.getScaleString(this._scale,this._startCenter)},_onTouchEnd:function(){if(this._moved&&this._zooming){var a=this._map;this._zooming=!1;L.DomUtil.removeClass(a._mapPane,"leaflet-touching");L.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var b=this._getScaleOrigin(),c=a.layerPointToLatLng(b),d=a.getZoom(),e=a.getScaleZoom(this._scale)-d,e=0<e?Math.ceil(e):Math.floor(e),d=a._limitZoom(d+e);a.fire("zoomanim",
{center:c,zoom:d});a._runAnimation(c,d,a.getZoomScale(d)/this._scale,b,!0)}},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}});L.Map.addInitHook("addHandler","touchZoom",L.Map.TouchZoom);L.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1});
L.Map.Keyboard=L.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109]},initialize:function(a){this._map=a;this._setPanOffset(a.options.keyboardPanOffset);this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0");L.DomEvent.addListener(a,"focus",this._onFocus,this).addListener(a,"blur",this._onBlur,this).addListener(a,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,
this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;L.DomEvent.removeListener(a,"focus",this._onFocus,this).removeListener(a,"blur",this._onBlur,this).removeListener(a,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){this._focused||this._map._container.focus()},_onFocus:function(){this._focused=!0;this._map.fire("focus")},_onBlur:function(){this._focused=
!1;this._map.fire("blur")},_setPanOffset:function(a){var b=this._panKeys={},c=this.keyCodes,d,e;d=0;for(e=c.left.length;d<e;d++)b[c.left[d]]=[-1*a,0];d=0;for(e=c.right.length;d<e;d++)b[c.right[d]]=[a,0];d=0;for(e=c.down.length;d<e;d++)b[c.down[d]]=[0,a];d=0;for(e=c.up.length;d<e;d++)b[c.up[d]]=[0,-1*a]},_setZoomOffset:function(a){var b=this._zoomKeys={},c=this.keyCodes,d,e;d=0;for(e=c.zoomIn.length;d<e;d++)b[c.zoomIn[d]]=a;d=0;for(e=c.zoomOut.length;d<e;d++)b[c.zoomOut[d]]=-a},_addHooks:function(){L.DomEvent.addListener(document,
"keydown",this._onKeyDown,this)},_removeHooks:function(){L.DomEvent.removeListener(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(a){var b=a.keyCode;if(this._panKeys.hasOwnProperty(b))this._map.panBy(this._panKeys[b]);else if(this._zoomKeys.hasOwnProperty(b))this._map.setZoom(this._map.getZoom()+this._zoomKeys[b]);else return;L.DomEvent.stop(a)}});L.Map.addInitHook("addHandler","keyboard",L.Map.Keyboard);L.Handler.MarkerDrag=L.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=(new L.Draggable(a,a)).on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this));this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},
_onDrag:function(){var a=L.DomUtil.getPosition(this._marker._icon);this._marker._shadow&&L.DomUtil.setPosition(this._marker._shadow,a);this._marker._latlng=this._marker._map.layerPointToLatLng(a);this._marker.fire("move").fire("drag")},_onDragEnd:function(){this._marker.fire("moveend").fire("dragend")}});L.Control=L.Class.extend({options:{position:"topright"},initialize:function(a){L.Util.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;b&&b.removeControl(this);this.options.position=a;b&&b.addControl(this);return this},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),a=a._controlCorners[c];L.DomUtil.addClass(b,"leaflet-control");-1!==c.indexOf("bottom")?a.insertBefore(b,a.firstChild):a.appendChild(b);
return this},removeFrom:function(a){var b=this.getPosition();a._controlCorners[b].removeChild(this._container);this._map=null;if(this.onRemove)this.onRemove(a);return this}});L.control=function(a){return new L.Control(a)};L.Map.include({addControl:function(a){a.addTo(this);return this},removeControl:function(a){a.removeFrom(this);return this},_initControlPos:function(){function a(a,f){b[a+f]=L.DomUtil.create("div",c+a+" "+c+f,d)}var b=this._controlCorners={},c="leaflet-",d=this._controlContainer=L.DomUtil.create("div",c+"control-container",this._container);a("top","left");a("top","right");a("bottom","left");a("bottom","right")}});L.Control.Zoom=L.Control.extend({options:{position:"bottomright"},onAdd:function(a){var b=L.DomUtil.create("div","leaflet-control-zoom");this._createButton("Zoom in","leaflet-control-zoom-in",b,a.zoomIn,a);this._createButton("Zoom out","leaflet-control-zoom-out",b,a.zoomOut,a);return b},_createButton:function(a,b,c,d,e){b=L.DomUtil.create("a",b,c);b.href="#";b.title=a;L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",d,e).on(b,"dblclick",L.DomEvent.stopPropagation);
return b}});L.Map.mergeOptions({zoomControl:!0});L.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new L.Control.Zoom,this.addControl(this.zoomControl))});L.control.zoom=function(a){return new L.Control.Zoom(a)};L.Control.Attribution=L.Control.extend({options:{position:"bottomright"},initialize:function(a){L.Util.setOptions(this,a);this._attributions={}},onAdd:function(a){this._container=L.DomUtil.create("div","leaflet-control-attribution");L.DomEvent.disableClickPropagation(this._container);a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},
setPrefix:function(a){this.options.prefix=a;this._update();return this},addAttribution:function(a){if(a)return this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this},removeAttribution:function(a){if(a)return this._attributions[a]--,this._update(),this},_update:function(){if(this._map){var a=[],b;for(b in this._attributions)this._attributions.hasOwnProperty(b)&&this._attributions[b]&&a.push(b);b=[];this.options.prefix&&b.push(this.options.prefix);a.length&&b.push(a.join(", "));
this._container.innerHTML=b.join(" &#8212; ")}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution())},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution())}});L.Map.mergeOptions({attributionControl:!1});L.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new L.Control.Attribution).addTo(this))});L.control.attribution=function(a){return new L.Control.Attribution(a)};L.Transition=L.Class.extend({includes:L.Mixin.Events,statics:{CUSTOM_PROPS_SETTERS:{position:L.DomUtil.setPosition},implemented:function(){return L.Transition.NATIVE||L.Transition.TIMER}},options:{easing:"ease",duration:0.5},_setProperty:function(a,b){var c=L.Transition.CUSTOM_PROPS_SETTERS;if(a in c)c[a](this._el,b);else this._el.style[a]=b}});L.Transition=L.Transition.extend({statics:function(){var a=L.DomUtil.TRANSITION;return{NATIVE:!!a,TRANSITION:a,PROPERTY:a+"Property",DURATION:a+"Duration",EASING:a+"TimingFunction",END:"webkitTransition"===a||"OTransition"===a?a+"End":"transitionend",CUSTOM_PROPS_PROPERTIES:{position:L.Browser.any3d?L.DomUtil.TRANSFORM:"top, left"}}}(),options:{fakeStepInterval:100},initialize:function(a,b){this._el=a;L.Util.setOptions(this,b);L.DomEvent.on(a,L.Transition.END,this._onTransitionEnd,this);this._onFakeStep=
L.Util.bind(this._onFakeStep,this)},run:function(a){var b,c=[],d=L.Transition.CUSTOM_PROPS_PROPERTIES;for(b in a)a.hasOwnProperty(b)&&(b=d[b]?d[b]:b,b=this._dasherize(b),c.push(b));this._el.style[L.Transition.DURATION]=this.options.duration+"s";this._el.style[L.Transition.EASING]=this.options.easing;this._el.style[L.Transition.PROPERTY]="all";for(b in a)a.hasOwnProperty(b)&&this._setProperty(b,a[b]);L.Util.falseFn(this._el.offsetWidth);this._inProgress=!0;L.Browser.mobileWebkit&&(this.backupEventFire=
setTimeout(L.Util.bind(this._onBackupFireEnd,this),1200*this.options.duration));L.Transition.NATIVE?(clearInterval(this._timer),this._timer=setInterval(this._onFakeStep,this.options.fakeStepInterval)):this._onTransitionEnd()},_dasherize:function(){function a(a){return"-"+a.toLowerCase()}var b=/([A-Z])/g;return function(c){return c.replace(b,a)}}(),_onFakeStep:function(){this.fire("step")},_onTransitionEnd:function(a){this._inProgress&&(this._inProgress=!1,clearInterval(this._timer),this._el.style[L.Transition.TRANSITION]=
"",clearTimeout(this.backupEventFire),delete this.backupEventFire,this.fire("step"),a&&a.type&&this.fire("end"))},_onBackupFireEnd:function(){var a=document.createEvent("Event");a.initEvent(L.Transition.END,!0,!1);this._el.dispatchEvent(a)}});L.Transition=L.Transition.NATIVE?L.Transition:L.Transition.extend({statics:{getTime:Date.now||function(){return+new Date},TIMER:!0,EASINGS:{linear:function(a){return a},"ease-out":function(a){return a*(2-a)}},CUSTOM_PROPS_GETTERS:{position:L.DomUtil.getPosition},UNIT_RE:/^[\d\.]+(\D*)$/},options:{fps:50},initialize:function(a,b){this._el=a;L.Util.extend(this.options,b);this._easing=L.Transition.EASINGS[this.options.easing]||L.Transition.EASINGS["ease-out"];this._step=L.Util.bind(this._step,this);
this._interval=Math.round(1E3/this.options.fps)},run:function(a){this._props={};var b=L.Transition.CUSTOM_PROPS_GETTERS,c=L.Transition.UNIT_RE;this.fire("start");for(var d in a)if(a.hasOwnProperty(d)){var e={};if(d in b)e.from=b[d](this._el);else{var f=this._el.style[d].match(c);e.from=parseFloat(f[0]);e.unit=f[1]}e.to=a[d];this._props[d]=e}clearInterval(this._timer);this._timer=setInterval(this._step,this._interval);this._startTime=L.Transition.getTime()},_step:function(){var a=L.Transition.getTime()-
this._startTime,b=1E3*this.options.duration;a<b?this._runFrame(this._easing(a/b)):(this._runFrame(1),this._complete())},_runFrame:function(a){var b=L.Transition.CUSTOM_PROPS_SETTERS,c,d;for(c in this._props)this._props.hasOwnProperty(c)&&(d=this._props[c],c in b?(d=d.to.subtract(d.from).multiplyBy(a).add(d.from),b[c](this._el,d)):this._el.style[c]=(d.to-d.from)*a+d.from+d.unit);this.fire("step")},_complete:function(){clearInterval(this._timer);this.fire("end")}});L.Map.include(!L.Transition||!L.Transition.implemented()?{}:{setView:function(a,b,c){var b=this._limitZoom(b),d=this._zoom!==b;if(this._loaded&&(!c&&this._layers)&&(d?this._zoomToIfClose&&this._zoomToIfClose(a,b):this._panByIfClose(a)))return clearTimeout(this._sizeTimer),this;this._resetView(a,b);return this},panBy:function(a,b){a=L.point(a);if(!a.x&&!a.y)return this;this._panTransition||(this._panTransition=new L.Transition(this._mapPane),this._panTransition.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},
this));L.Util.setOptions(this._panTransition,L.Util.extend({duration:0.25},b));this.fire("movestart");L.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");this._panTransition.run({position:L.DomUtil.getPosition(this._mapPane).subtract(a)});return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_panByIfClose:function(a){a=this._getCenterOffset(a)._floor();return this._offsetIsWithinView(a)?
(this.panBy(a),!0):!1},_offsetIsWithinView:function(a,b){var c=b||1,d=this.getSize();return Math.abs(a.x)<=d.x*c&&Math.abs(a.y)<=d.y*c}});L.Map.mergeOptions({zoomAnimation:L.DomUtil.TRANSITION&&!L.Browser.android23&&!L.Browser.mobileOpera});L.DomUtil.TRANSITION&&L.Map.addInitHook(function(){L.DomEvent.on(this._mapPane,L.Transition.END,this._catchTransitionEnd,this)});
L.Map.include(!L.DomUtil.TRANSITION?{}:{_zoomToIfClose:function(a,b){if(this._animatingZoom)return!0;if(!this.options.zoomAnimation)return!1;var c=this.getZoomScale(b),d=this._getCenterOffset(a).divideBy(1-1/c);if(!this._offsetIsWithinView(d,1))return!1;L.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this.fire("movestart").fire("zoomstart");this.fire("zoomanim",{center:a,zoom:b});d=this._getCenterLayerPoint().add(d);this._prepareTileBg();this._runAnimation(a,b,c,d);return!0},_catchTransitionEnd:function(){this._animatingZoom&&
this._onZoomTransitionEnd()},_runAnimation:function(a,b,c,d,e){this._animateToCenter=a;this._animateToZoom=b;this._animatingZoom=!0;a=L.DomUtil.TRANSFORM;b=this._tileBg;clearTimeout(this._clearTileBgTimer);L.Util.falseFn(b.offsetWidth);c=L.DomUtil.getScaleString(c,d);d=b.style[a];b.style[a]=e?d+" "+c:c+" "+d},_prepareTileBg:function(){var a=this._tilePane,b=this._tileBg;b&&0.5<this._getLoadedTilesPercentage(b)&&0.5>this._getLoadedTilesPercentage(a)?(a.style.visibility="hidden",a.empty=!0):(b||(b=
this._tileBg=this._createPane("leaflet-tile-pane",this._mapPane),b.style.zIndex=1),b.style[L.DomUtil.TRANSFORM]="",b.style.visibility="hidden",b.empty=!0,a.empty=!1,this._tilePane=this._panes.tilePane=b,a=this._tileBg=a,L.DomUtil.addClass(a,"leaflet-zoom-animated"));this._stopLoadingImages(a)},_getLoadedTilesPercentage:function(a){var a=a.getElementsByTagName("img"),b,c,d=0;b=0;for(c=a.length;b<c;b++)a[b].complete&&d++;return d/c},_stopLoadingImages:function(a){var a=Array.prototype.slice.call(a.getElementsByTagName("img")),
b,c,d;b=0;for(c=a.length;b<c;b++)d=a[b],d.complete||(d.onload=L.Util.falseFn,d.onerror=L.Util.falseFn,d.src=L.Util.emptyImageUrl,d.parentNode.removeChild(d))},_onZoomTransitionEnd:function(){this._restoreTileFront();L.Util.falseFn(this._tileBg.offsetWidth);this._resetView(this._animateToCenter,this._animateToZoom,!0,!0);L.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._animatingZoom=!1},_restoreTileFront:function(){this._tilePane.innerHTML="";this._tilePane.style.visibility="";this._tilePane.style.zIndex=
2;this._tileBg.style.zIndex=1},_clearTileBg:function(){!this._animatingZoom&&!this.touchZoom._zooming&&(this._tileBg.innerHTML="")}});L.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:Infinity,timeout:1E4,maximumAge:0,enableHighAccuracy:!1},locate:function(a){a=this._locationOptions=L.Util.extend(this._defaultLocateOptions,a);if(!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported"}),this;var b=L.Util.bind(this._handleGeolocationResponse,this),c=L.Util.bind(this._handleGeolocationError,this);a.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,c,a):
navigator.geolocation.getCurrentPosition(b,c,a);return this},stopLocate:function(){navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId);return this},_handleGeolocationError:function(a){var b=a.code,a=a.message||(1===b?"permission denied":2===b?"position unavailable":"timeout");this._locationOptions.setView&&!this._loaded&&this.fitWorld();this.fire("locationerror",{code:b,message:"Geolocation error: "+a+"."})},_handleGeolocationResponse:function(a){var b=180*a.coords.accuracy/
4E7,c=2*b,d=a.coords.latitude,e=a.coords.longitude,f=new L.LatLng(d,e),g=new L.LatLng(d-b,e-c),b=new L.LatLng(d+b,e+c),g=new L.LatLngBounds(g,b),b=this._locationOptions;b.setView&&(b=Math.min(this.getBoundsZoom(g),b.maxZoom),this.setView(f,b));this.fire("locationfound",{latlng:f,bounds:g,accuracy:a.coords.accuracy})}});L.Label=L.Popup.extend({options:{autoPan:!1,className:"",closePopupOnClick:!1,noHide:!1,offset:new L.Point(17,-15)},onAdd:function(a){this._map=a;this._container||this._initLayout();this._updateContent();var b=a.options.fadeAnimation;b&&L.DomUtil.setOpacity(this._container,0);a._panes.popupPane.appendChild(this._container);a.on("viewreset",this._updatePosition,this);if(L.Browser.any3d)a.on("zoomanim",this._zoomAnimation,this);this._update();b&&L.DomUtil.setOpacity(this._container,1)},close:function(){var a=
this._map;a&&(a._label=null,a.removeLayer(this))},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-label "+this.options.className+" leaflet-zoom-animated")},_updateContent:function(){this._content&&"string"===typeof this._content&&(this._container.innerHTML=this._content)},_updateLayout:function(){},_updatePosition:function(){var a=this._map.latLngToLayerPoint(this._latlng);this._setPosition(a)},_setPosition:function(a){a=a.add(this.options.offset);L.DomUtil.setPosition(this._container,
a)},_zoomAnimation:function(a){a=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);this._setPosition(a)}});L.FeatureGroup.include({clearLayers:function(){this.unbindLabel();this.eachLayer(this.removeLayer,this);return this},bindLabel:function(a,b){return this.invoke("bindLabel",a,b)},unbindLabel:function(){return this.invoke("unbindLabel")},updateLabelContent:function(a){this.invoke("updateLabelContent",a)}});L.Path.include({bindLabel:function(a,b){if(!this._label||this._label.options!==b)this._label=new L.Label(b,this);this._label.setContent(a);this._showLabelAdded||(this.on("mouseover",this._showLabel,this).on("mousemove",this._moveLabel,this).on("mouseout remove",this._hideLabel,this),this._showLabelAdded=!0);return this},unbindLabel:function(){this._label&&(this._hideLabel(),this._label=null,this._showLabelAdded=!1,this.off("mouseover",this._showLabel).off("mousemove",this._moveLabel).off("mouseout remove",
this._hideLabel));return this},disableLabel:function(){this._label&&(this._label.disabled=!0,this._label.close())},enableLabel:function(){this._label&&(this._label.disabled=!1)},updateLabelContent:function(a){this._label&&this._label.setContent(a)},_showLabel:function(a){this._label.setLatLng(a.latlng);this._map.showLabel(this._label)},_moveLabel:function(a){this._label.setLatLng(a.latlng)},_hideLabel:function(){this._label.close()}});L.Icon.Default.mergeOptions({labelAnchor:new L.Point(9,-20)});L.Marker.mergeOptions({icon:new L.Icon.Default});
L.Marker.include({showLabel:function(){this._label&&this._map&&(this._label.setLatLng(this._latlng),this._map.showLabel(this._label));return this},hideLabel:function(){this._label&&this._label.close();return this},bindLabel:function(a,b){var c=L.point(this.options.icon.options.labelAnchor)||new L.Point(0,0),c=c.add(L.Label.prototype.options.offset);b&&b.offset&&(c=c.add(b.offset));b=L.Util.extend({offset:c},b);if(!this._label){if(!b.noHide)this.on("mouseover",this.showLabel,this).on("mouseout",this.hideLabel,
this);this.on("remove",this.hideLabel,this).on("dragstart",this.disableLabel,this).on("dragend",this.enableLabel,this);this._haslabelHandlers=!0}this._label=(new L.Label(b,this)).setContent(a);return this},unbindLabel:function(){this._label&&(this.hideLabel(),this._label=null,this._haslabelHandlers&&this.off("mouseover",this.showLabel).off("mouseout",this.hideLabel).off("remove",this.hideLabel).off("dragstart",this.disableLabel).off("dragend",this.enableLabel),this._haslabelHandlers=!1);return this},
disableLabel:function(){this._label&&(this._label.disabled=!0,this._label.close())},enableLabel:function(){this._label&&(this._label.disabled=!1)},updateLabelContent:function(a){this._label&&this._label.setContent(a)},_moveLabel:function(a){this._label.setLatLng(a.latlng)}});L.Map.include({showLabel:function(a){this._label=a;if(!a.disabled)return this.addLayer(a)}});
L.Map.mergeOptions({drawControl:!1});
L.Control.Draw=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",polyline:{title:"Line"},polygon:{title:"Polygon"},point:{title:"Point"},label:!1,multiple:!1},onAdd:function(a){this._map=a;this.handlers={};var b=L.DomUtil.create("div","leaflet-control-draw"),c={point:L.Point.Draw,polyline:L.Polyline.Draw,polygon:L.Polygon.Draw},d,e;L.DomUtil.create("div","background",b);var f=L.DomUtil.create("div","handlers",b),g;for(g in c)if(e=this.options[g])d=this.handlers[g]=(new c[g](a,
e)).on("activated",this._onDrawingStarted,this).on("deactivated",this._onEditDrawEnded,this).on("help-updated",this._onHelpUpdated,this),this._createButton(e.title,"leaflet-control-draw-"+g,f,d.enable,d);this._createButton("Clear","leaflet-control-draw-clear",f,this.clearFeatures,this);this.handlers.edit=(new L.Handler.Edit(a)).on("activated",this._onEditingStarted,this).on("deactivated",this._onEditDrawEnded,this).on("help-updated",this._onHelpUpdated,this);a=L.DomUtil.create("div","actions",b);
this._createButton("Cancel","leaflet-control-draw-cancel",a,this._onCancelClick,this);this._createButton("Done","leaflet-control-draw-done",a,this._onDoneClick,this);f=L.DomUtil.create("div","help",f);this.helpTitle=L.DomUtil.create("h2","",f);this.helpLabel=L.DomUtil.create("span","",f);this._map.on("draw:feature-created",this._onFeatureCreated,this).on("edit:feature-changed",this._onFeatureChanged,this).on("locate:location-set",this._onGeoLocationSet,this);this._featureGroup=this.options.layer;
this._featureGroup.on("click",this._onFeatureClick,this);return b},onRemove:function(a){a.off("draw:feature-created",this._onFeatureCreated).off("edit:feature-changed",this._onFeatureChanged).off("locate:location-set",this._onGeoLocationSet);if(this.handlers){for(var b in this.handlers)this.handlers[b].off("activated").off("deactivated").off("help-updated"),this.handlers[b].enabled()&&this.handlers[b].disable();delete this.handlers}this._featureGroup&&(this._featureGroup.off("click",this._onFeatureClick).clearLayers(),
delete this._featureGroup)},addFeature:function(a,b){this.bindLabel(a);this._featureGroup.addLayer(a);!1!==b&&this._fireFeaturesChanged()},addFeatures:function(a){var b,c=a.length;for(b=0;b<c;b++)this.addFeature(a[b],!1);this._fireFeaturesChanged()},bindLabel:function(a){a.bindLabel&&(a.options&&a.options.label)&&a.bindLabel(AlteryxJS.Util.escapeHtml(a.options.label))},clearFeatures:function(){this._map.closePopup();this._featureGroup.clearLayers();this._fireFeaturesChanged()},eachLayer:function(a,
b){this._featureGroup.eachLayer(a,b)},removeFeature:function(a){this._featureGroup.removeLayer(a);this._fireFeaturesChanged()},_buildGeoLocationPopup:function(a){var b=a.roundTo(6),c=L.DomUtil.create("div","leaflet-feature-info");L.DomUtil.create("h2","",c).innerHTML="Location Found!";L.DomUtil.create("span","content",c).innerHTML="We've spotted you at <strong>"+b.lat+","+b.lng+"</strong>.<br />Would you like to add a point here?";b=[{label:"Yes, add a point",callback:L.Util.bind(function(){this._onDrawLocationPoint(a)},
this)},{label:"No thanks",callback:L.Util.bind(this._map.closePopup,this._map)}];this._buildPopupButtons(b,c);return c},_buildPopup:function(a){var b=L.DomUtil.create("div","leaflet-feature-info");if(this.options.label){var c="No Label";a.options&&a.options.label&&(c=AlteryxJS.Util.escapeHtml(a.options.label));L.DomUtil.create("h2","",b).innerHTML=c}c=[{label:"Modify",callback:L.Util.bind(function(b){this._onModifyClick(b,a)},this)},{label:"Delete",callback:L.Util.bind(function(b){this._onDeleteClick(b,
a)},this)}];this.options.label&&c.unshift({label:"Rename",callback:L.Util.bind(function(b){this._onRenameClick(b,a)},this)});this._buildPopupButtons(c,b);return b},_buildPopupButtons:function(a,b){var c,d=a.length,e,f;for(c=0;c<d;c++)e=a[c],f=L.DomUtil.create("button",e.label.toLowerCase().replace(/[\W\s]/g,"-"),b),f.innerHTML=e.label,L.DomEvent.on(f,L.Browser.touch?"touchstart":"click",e.callback)},_createButton:function(a,b,c,d,e){b=L.DomUtil.create("a",b,c);b.href="#";b.title=a;L.DomUtil.create("span",
null,b).innerHTML=a;L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"mousedown",L.DomEvent.stopPropagation).on(b,"dblclick",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",d,e);return b},_fireFeaturesChanged:function(){this.fire("features-changed",{featureGroup:this._featureGroup})},_onCancelClick:function(){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&this.handlers[a].enabled()&&this.handlers[a].cancel()},_onDeleteClick:function(a,b){L.DomEvent.stop(a);
this.handlers.edit.disable();this.removeFeature(b);this._map.closePopup()},_onDeleteCurrentFeature:function(a){this.clearFeatures();a.enable()},_onDoneClick:function(){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&this.handlers[a].enabled()&&this.handlers[a].finishShape()},_onDrawingStarted:function(a){this._drawing=!0;this._map.dragging&&this._map.dragging._draggable&&(this._map.dragging._draggable.buffer=15);this._map.closePopup();if(!this.options.multiple){var b=0;this._featureGroup&&
this._featureGroup.eachLayer(function(){b++},this);if(0<b){var c=a.target;new L.Dialog.Action(this._map,{title:"Only one feature may be drawn!",buttons:[{label:"Remove Current Feature",className:"remove",callback:function(){this._onDeleteCurrentFeature(c)},context:this},{label:"Move To Current Feature",className:"pan-to",callback:this._onMoveToCurrentFeature,context:this}]});setTimeout(L.Util.bind(c.disable,c),10)}}"Point"==a.target.options.title&&L.DomUtil.addClass(this._container,"no-done");L.DomUtil.addClass(this._container,
"activated");this.helpTitle.innerHTML="Draw "+a.target.options.title},_onDrawLocationPoint:function(a){this._map.closePopup();this.options.multiple||this.clearFeatures();var b;this.options.label&&(b=a.roundTo(6),b=b.lat+","+b.lng);this.handlers.point._addPoint(a,b)},_onEditDrawEnded:function(){this._drawing=!1;this._map.dragging&&this._map.dragging._draggable&&(this._map.dragging._draggable.buffer=0);L.DomUtil.removeClass(this._container,"activated");L.DomUtil.removeClass(this._container,"no-done");
this.helpTitle.innerHTML="";this.helpLabel.innerHTML=""},_onEditingStarted:function(){this._map.closePopup();var a=this.handlers.edit,b=a.feature.options.label?AlteryxJS.Util.escapeHtml(a.feature.options.label):"Feature";"point"==a.feature.options.type&&L.DomUtil.addClass(this._container,"no-done");L.DomUtil.addClass(this._container,"activated");this.helpTitle.innerHTML="Edit "+b},_onFeatureChanged:function(){this._fireFeaturesChanged()},_onFeatureCreated:function(a){var b=a.feature;this.addFeature(b);
this.options.label&&new L.Dialog.Prompt(this._map,{title:"Label this feature",label:"Enter a label for this feature below",value:b.options.label,callback:L.Util.bind(function(a){b.options.label=a;this.bindLabel(b);this._fireFeaturesChanged()},this)})},_onFeatureClick:function(a){if(!this._drawing){L.DomEvent.stop(a.originalEvent);var b=a.layer,c;"point"==b.options.type?(c=new L.Point(0,-40),a=b.getLatLng()):(c=new L.Point(0,6),a=a.latlng);b=L.popup({closeButton:!1,maxWidth:350,offset:c}).setLatLng(a).setContent(this._buildPopup(b)).openOn(this._map);
this._map.openPopup(b)}},_onGeoLocationSet:function(a){this.handlers&&this.handlers.point&&(a=a.location.latlng,this._pointExists(a)||(a=L.popup({closeButton:!1,maxWidth:350,offset:new L.Point(0,6)}).setLatLng(a).setContent(this._buildGeoLocationPopup(a)).openOn(this._map),this._map.openPopup(a)))},_onHelpUpdated:function(a){this.helpLabel.innerHTML=a.content},_onModifyClick:function(a,b){var c=this.handlers.edit;c.enabled()&&c.disable();c.enable(b)},_onMoveToCurrentFeature:function(){var a;this._featureGroup&&
(this._featureGroup.eachLayer(function(b){a=b},this),this._map.panTo(a.getBounds?a.getBounds().getCenter():a.getLatLng()))},_onRenameClick:function(a,b){this._map.closePopup();new L.Dialog.Prompt(this._map,{title:"Label this feature",label:"Enter a label for this feature below",value:b.options.label,callback:L.Util.bind(function(a){b.options.label=a;b.bindLabel&&a&&b.bindLabel(AlteryxJS.Util.escapeHtml(a));this._fireFeaturesChanged()},this)})},_pointExists:function(a){var b=!1;this._featureGroup&&
this._featureGroup.eachLayer(function(c){c&&c.getLatLng&&(c=c.getLatLng(),c.lat==a.lat&&c.lng==a.lng&&(b=!0))},this);return b}});L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))});L.Handler.Draw=L.Handler.extend({includes:L.Mixin.Events,options:{shapeOptions:{stroke:!0,color:"#05f",weight:12,opacity:0.6,fill:!1,clickable:!1}},initialize:function(a,b){this._map=a;this._container=a._container;this._overlayPane=a._panes.overlayPane;this._popupPane=a._panes.popupPane;b&&b.shapeOptions&&(b.shapeOptions=L.Util.extend({},this.options.shapeOptions,b.shapeOptions));L.Util.extend(this.options,b)},enable:function(){this.fire("activated");this._map.fire("drawing-enabled",{drawingType:this.type});
L.Handler.prototype.enable.call(this)},disable:function(){this.fire("deactivated");this._map.fire("drawing-disabled",{drawingType:this.type});L.Handler.prototype.disable.call(this)},cancel:function(){this.disable()},addHooks:function(){this._map&&(L.DomUtil.disableTextSelection(),L.DomEvent.on(window,"keyup",this._onKeyUp,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),L.DomEvent.off(window,"keyup",this._onKeyUp))},_onKeyUp:function(a){27===a.keyCode&&this.cancel()}});L.Point.Draw=L.Handler.Draw.extend({type:"point",options:{icon:new L.DivIcon({className:"point-marker",iconSize:[25,41],iconAnchor:new L.Point(13,41)}),zIndexOffset:2E3},addHooks:function(){L.Handler.Draw.prototype.addHooks.call(this);if(this._map){this.fire("help-updated",{content:(L.Browser.touch?"Tap":"Click")+" map to place marker."});if(!L.Browser.touch)this._map.on("mousemove",this._onMouseMove,this);this._map.on("click",this._onClick,this)}},removeHooks:function(){L.Handler.Draw.prototype.removeHooks.call(this);
this._map&&(this._marker&&(this._marker.off("click",this._onMarkerClick),this._map.removeLayer(this._marker),delete this._marker),L.Browser.touch||this._map.off("mousemove",this._onMouseMove),this._map.off("click",this._onClick))},_addPoint:function(a,b){var c={icon:this.options.icon,draggable:!1,clickable:!0,type:this.type};b&&(c.label=b);this._map.fire("draw:feature-created",{feature:new L.Marker(a,c)});this.disable()},_onClick:function(a){this._addPoint(a.latlng)},_onMarkerClick:function(){this._addPoint(this._marker.getLatLng())},
_onMouseMove:function(a){this._marker?this._marker.setLatLng(a.latlng):this._marker=(new L.Marker(a.latlng,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})).addTo(this._map).on("click",this._onMarkerClick,this)}});L.Marker.include({toGeoJSON:function(){var a=this.getLatLng().roundTo(6);return'{"type":"point","coordinates":['+a.lng+","+a.lat+"]}"}});L.LatLng.prototype.roundTo=function(a){return{lat:parseFloat(this.lat).toFixed(a),lng:parseFloat(this.lng).toFixed(a)}};L.Polyline.Draw=L.Handler.Draw.extend({Poly:L.Polyline,type:"polyline",options:{icon:new L.divIcon({className:"edit-marker",iconSize:L.Browser.touch?[39,39]:[23,23]}),shapeOptions:{stroke:!0,color:"#05f",weight:12,opacity:0.6,fill:!1,clickable:!1},zIndexOffset:2E3},initialize:function(a,b){L.Handler.Draw.prototype.initialize.call(this,a,b)},addHooks:function(){L.Handler.Draw.prototype.addHooks.call(this);if(this._map){this.fire("help-updated",{content:(L.Browser.touch?"Tap":"Click")+" to start drawing."});
this._poly=(new L.Polyline([],this.options.shapeOptions)).addTo(this._map);this._map.on("click",this._onClick,this).on("dblclick",this._onDblClick,this);if(!L.Browser.touch)this._map.on("mousemove",this._onMouseMove,this);this._map.doubleClickZoom&&this._map.doubleClickZoom.removeHooks()}},removeHooks:function(){L.Handler.Draw.prototype.removeHooks.call(this);this._map&&(this._poly&&(this._map.removeLayer(this._poly),delete this._poly),this._marker&&(this._map.removeLayer(this._marker),delete this._marker),
this._guide&&(this._map.removeLayer(this._guide),delete this._guide),this._map.off("click",this._onClick).off("dblclick",this._onDblClick),L.Browser.touch||this._map.off("mousemove",this._onMouseMove),this._map.doubleClickZoom&&this._map.doubleClickZoom.addHooks())},finishShape:function(){if(this._shapeIsValid()){var a=this.options.shapeOptions;a.clickable=!0;a.type=this.type;this._map.fire("draw:feature-created",{feature:new this.Poly(this._poly.getLatLngs(),a)});this.disable()}},_addLatLng:function(a){this._poly.addLatLng(a);
L.Browser.touch?this._marker?this._marker.setLatLng(a):this._marker=(new L.Marker(a,{icon:this.options.icon,clickable:!1})).addTo(this._map):this._guide?this._guide.setLatLngs([a,a]):this._guide=(new L.Polyline([],{stroke:!0,color:"#555",weight:12,opacity:0.6,fill:!1,clickable:!1,smoothFactor:0})).addTo(this._map);this._polyRedo=[];this._updateHelpContent()},_onClick:function(a){var b=this.lastClick,c=a.layerPoint;if(!b||!(b.x==c.x&&b.y==c.y))this._addLatLng(a.latlng),this.lastClick=c},_onDblClick:function(){this.finishShape()},
_onKeyUp:function(a){L.Handler.Draw.prototype._onKeyUp.call(this,a);a.ctrlKey?90===a.keyCode?this._undoLatLng():89===a.keyCode&&this._redoLatLng():13===a.keyCode&&this.finishShape()},_onMouseMove:function(a){this._guide&&this._guide.spliceLatLngs(1,1,a.latlng)},_undoLatLng:function(){var a=this._poly.getLatLngs();0<a.length&&(this._polyRedo.unshift(this._poly.spliceLatLngs(-1,1)[0]),this._guide&&this._guide.spliceLatLngs(0,1,a[a.length-1]),this._updateHelpContent())},_redoLatLng:function(){if(this._polyRedo&&
!(1>this._polyRedo.length)){var a=this._polyRedo.shift();this._poly.addLatLng(a);this._guide&&this._guide.spliceLatLngs(0,1,a);this._updateHelpContent()}},_shapeIsValid:function(){return this._poly&&1<this._poly.getLatLngs().length},_updateHelpContent:function(){switch(this._poly.getLatLngs().length){case 1:this.fire("help-updated",{content:(L.Browser.touch?"Tap":"Click")+" again to continue drawing."});break;case 2:this.fire("help-updated",{content:(L.Browser.touch?"Tap":"Click")+" done when you're finished."})}}});
L.Polyline.include({toGeoJSON:function(){var a=this.getLatLngs(),b,c=a.length,d,e=[];for(b=0;b<c;b++)d=a[b].roundTo(6),e.push("["+d.lng+","+d.lat+"]");return'{"type":"linestring","coordinates":['+e.join(",")+"]}"}});L.Polygon.Draw=L.Polyline.Draw.extend({Poly:L.Polygon,type:"polygon",options:{shapeOptions:{stroke:!0,color:"#05f",weight:8,opacity:0.6,fill:!0,fillColor:"#0af",fillOpacity:0.5,clickable:!1}},_shapeIsValid:function(){return this._poly&&2<this._poly.getLatLngs().length},_updateHelpContent:function(){switch(this._poly.getLatLngs().length){case 1:case 2:this.fire("help-updated",{content:(L.Browser.touch?"Tap":"Click")+" again to continue drawing."});break;case 3:this.fire("help-updated",{content:(L.Browser.touch?
"Tap":"Click")+" done when you're finished."})}}});L.Polygon.include({toGeoJSON:function(){var a=this.getLatLngs(),b,c=a.length,d=[],e=function(a){a=a.roundTo(6);return"["+a.lng+","+a.lat+"]"};for(b=0;b<c;b++)d.push(e(a[b]));a[0]!==a[c-1]&&d.push(e(a[0]));return'{"type":"polygon","coordinates":[['+d.join(",")+"]]}"}});L.Map.mergeOptions({selectControl:!1});
L.Control.Select=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",point:{title:"Click"},rectangle:{title:"Box"},multiple:!1},onAdd:function(a){this._map=a;this.handlers={};this._stack=new L.SelectionStack({store:!0,selectionUrlTemplate:this.options.selectionUrlTemplate});this._stack.on("store:success",this._onSetSelectionSuccess,this).on("store:error",this._onSetSelectionError,this).on("store:delay",function(){this._showDelayDialog("Storing selection...")},this);var b={point:L.Handler.SelectPoint};
this.options.multiple&&(b.rectangle=L.Handler.SelectRectangle);var c=L.DomUtil.create("div","leaflet-control-select");L.DomUtil.create("div","background",c);var d=L.DomUtil.create("div","handlers",c),e;for(e in b){var f=this.options[e];if(f){var g=this.handlers[e]=(new b[e](a,f)).on("activated",this._onSelectStarted,this).on("deactivated",this._onSelectEnded,this);this._createButton(f.title,"leaflet-control-select-"+f.title.toLowerCase(),d,g.enable,g)}}this._createButton("Clear","leaflet-control-select-clear",
d,this.clearSelection,this);this._map.on("select:click",this._onSelectClick,this).on("select:bounds",this._onSelectBounds,this);setTimeout(L.Util.bind(this.handlers.point.enable,this.handlers.point),50);return c},onRemove:function(a){a.off("select:click",this._onSelectClick).off("select:bounds",this._onSelectBounds);if(this.handlers){for(var b in this.handlers)this.handlers[b].off("activated"),this.handlers[b].enabled()&&this.handlers[b].disable();delete this.handlers}a.dragging&&a.dragging._draggable&&
(a.dragging._draggable.buffer=0);this._stack&&(this._stack.off("store:success").off("store:error").off("store:delay").destroy(),delete this._stack)},clearSelection:function(){this._stack.clear()},getSelectionStack:function(){return this._stack.serialize()},setSelectionStack:function(a,b){this._setBounds=!1===b?!1:!0;this._stack.deserialize(a)},setTileSetId:function(a){"undefined"!=typeof this._tileSetId&&this._tileSetId!=a&&this.clearSelection();this._tileSetId=a;this._stack.options.tileSetId=a},
setLabelField:function(a){this._labelField=a;this._stack.options.labelField=a},_buildBoundsFromString:function(a){if("string"==typeof a)return a=a.split(","),[[parseFloat(a[2]),parseFloat(a[0])],[parseFloat(a[3]),parseFloat(a[1])]]},_createButton:function(a,b,c,d,e){b=L.DomUtil.create("a",b,c);b.href="#";b.title=a;L.DomUtil.create("span",null,b).innerHTML=a;L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"mousedown",L.DomEvent.stopPropagation).on(b,"dblclick",L.DomEvent.stopPropagation).on(b,
"click",L.DomEvent.preventDefault).on(b,"click",d,e);return b},_destroyDialog:function(){if(this._dialog&&!("select"==this._dialog.options.type||"action"==this._dialog.options.type))this._dialog.destroy(),delete this._dialog},_getActiveHandlerTitle:function(){for(var a in this.handlers)if(this.handlers.hasOwnProperty(a)&&this.handlers[a].enabled())return this.handlers[a].options.title},_onFeaturesSelected:function(a,b,c){this._destroyDialog();b&&0<b.length&&(a.options.append||this._stack.clear(),
this._stack.merge(a).addOperation({type:"Suppress",addIds:c,dropIds:b}));a.destroy()},_onSearchError:function(a){var b=a.stack,c=a.data,a=a.request;this._destroyDialog();c="Error!\r\n"+(c&&c.message?c.message:c||"Unknown Error");a&&(c+="\r\n["+a.data+"]");alert(c);b.destroy()},_onSearchSuccess:function(a){var b=a.stack,c=a.data;this._destroyDialog();if(b&&c){var a=b.getTypes(),d=c.bounds,e=c.count,c=c.records;!e||1>e?b.destroy():1==e||1==a.length&&"Area"===a[0]?(b.options.append||this._stack.clear(),
1==e&&(c&&1==c.length&&0<c[0].length)&&this._stack.addOperation({type:"Suppress",dropIds:c[0][0].toString()}),this._stack.merge(b),b.destroy()):50<e?this._showZoomDialog(b,d):this._showSelectDialog(b,c)}},_onSelectBounds:function(a){this._searchForFeatures("Area",a.geoJSON,a.originalEvent.ctrlKey)},_onSelectClick:function(a){this._searchForFeatures("Click",a.geoJSON,a.originalEvent.ctrlKey)},_onSelectEnded:function(){this._map&&(this._map.dragging&&this._map.dragging._draggable)&&(this._map.dragging._draggable.buffer=
0)},_onSelectStarted:function(a){if(this._map&&this._container){this._map.closePopup();for(var b in this.handlers)this.handlers.hasOwnProperty(b)&&this.handlers[b].enabled()&&this.handlers[b].disable();this._map.dragging&&this._map.dragging._draggable&&(this._map.dragging._draggable.buffer=15);b=this._container.getElementsByTagName("a");for(var a="leaflet-control-select-"+a.target.options.title.toLowerCase(),c=0,d=b.length;c<d;c++)L.DomUtil.hasClass(b[c],a)?L.DomUtil.addClass(b[c],"activated"):L.DomUtil.removeClass(b[c],
"activated")}},_onSetSelectionError:function(a){var b=a.data,a=a.request;this._destroyDialog();b="Error!\r\n"+(b&&b.message?b.message:b||"Unknown Error");a&&(b+="\r\n["+a.data+"]");alert(b)},_onSetSelectionSuccess:function(a){var b=a.data;this._destroyDialog();this._map.whenReady(function(){if(this._setBounds&&b.bounds){var a=this._buildBoundsFromString(b.bounds);this._map.fitBounds(a);delete this._setBounds}this.fire("selection-changed",{stack:this._stack})},this)},_showDelayDialog:function(a){this._destroyDialog();
this._dialog=new L.Dialog.Loading(this._map,{title:"",msg:a})},_searchForFeatures:function(a,b,c){(new L.SelectionStack({store:!1,append:c&&this.options.multiple,tileSetId:this._tileSetId,labelField:this._labelField,selectionUrlTemplate:this.options.selectionUrlTemplate})).on("search:success",this._onSearchSuccess,this).on("search:error",this._onSearchError,this).on("search:delay",function(){this._showDelayDialog("Searching for features...")},this).addOperation({type:a,value:b}).search()},_showSelectDialog:function(a,
b){this._destroyDialog();for(var c=[],d,e=0,f=b.length;e<f;e++)d=b[e],c.push({key:d[0],label:d[1],checked:this._stack.isIdSelected(d[0])?!0:!1});this._dialog=new L.Dialog.Select(this._map,{title:"Multiple Features Found",content:"Select the feature"+(this.options.multiple?"s":"")+" you want below.",options:c,multiple:this.options.multiple,callback:L.Util.bind(function(b,c){this._onFeaturesSelected(a,b,c)},this)})},_showZoomDialog:function(a,b){this._destroyDialog();b=this._buildBoundsFromString(b);
this._dialog=new L.Dialog.Action(this._map,{title:"Large Selection",content:"More than 50 features exist here. You can add all to your selection, or zoom in to select fewer features.",buttons:[{label:"Add All To Selection",className:"add-all",callback:function(){a.options.append||this._stack.clear();this._stack.merge(a);a.destroy()},context:this},{label:"Zoom To Features",className:"zoom-to",callback:function(){this._map.fitBounds(b);a.destroy()},context:this}]})}});
L.Map.addInitHook(function(){this.options.selectControl&&(this.selectControl=new L.Control.Select,this.addControl(this.selectControl))});L.Handler.Select=L.Handler.extend({includes:L.Mixin.Events,options:{},initialize:function(a,b){this._map=a;this._container=a._container;this.options&&b&&L.Util.extend(this.options,b)},enable:function(){this.fire("activated");this._map.fire("selecting-enabled");L.Handler.prototype.enable.call(this)},disable:function(){this.fire("deactivated");this._map.fire("selecting-disabled");L.Handler.prototype.disable.call(this)},cancel:function(){this.disable()},finish:function(){this.disable()},addHooks:function(){this._map&&
(L.DomUtil.disableTextSelection(),L.DomEvent.on(this._container,"keyup",this._onKeyUp,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),L.DomEvent.off(this._container,"keyup",this._onKeyUp))},_onKeyUp:function(a){27===a.keyCode&&this.cancel()}});L.Handler.SelectPoint=L.Handler.Select.extend({options:{clickBuffer:8},addHooks:function(){L.Handler.Select.prototype.addHooks.call(this);if(this._map)this._map.on("click",this._onClickDelay,this).on("dblclick",this._onDblClick,this)},removeHooks:function(){this._map&&this._map.off("click",this._onClickDelay).off("dblclick",this._onDblClick);this._mouseDelay&&(clearTimeout(this._mouseDelay),delete this._mouseDelay);L.Handler.Select.prototype.removeHooks.call(this)},_onClick:function(a){for(var b=
a.containerPoint,c=this.options.clickBuffer,d=new L.Polygon([]),c=[{x:0,y:-1*c},{x:c,y:0},{x:0,y:c},{x:-1*c,y:0}],e=0;e<c.length;e++)d.addLatLng(this._map.containerPointToLatLng([b.x+c[e].x,b.y+c[e].y]));this._map.fire("select:click",{geoJSON:d.toGeoJSON(),originalEvent:a.originalEvent})},_onClickDelay:function(a){this._mouseDelay&&clearTimeout(this._mouseDelay);var b={containerPoint:a.containerPoint,originalEvent:{ctrlKey:a.originalEvent.ctrlKey}};this._mouseDelay=setTimeout(L.Util.bind(function(){this._onClick(b)},
this),150)},_onDblClick:function(){this._mouseDelay&&clearTimeout(this._mouseDelay)}});L.Handler.SelectRectangle=L.Handler.SelectPoint.extend({statics:{START:L.Browser.touch?"touchstart":"mousedown",END:L.Browser.touch?"touchend":"mouseup",MOVE:L.Browser.touch?"touchmove":"mousemove"},options:{shapeOptions:{stroke:!0,color:"#05f",weight:8,opacity:0.6,fill:!0,fillColor:"#0af",fillOpacity:0.5,clickable:!1}},addHooks:function(){L.Handler.SelectPoint.prototype.addHooks.call(this);this._map&&(L.DomUtil.disableTextSelection(),this._map.dragging&&this._map.dragging.disable(),L.DomEvent.on(this._map._container,
L.Handler.SelectRectangle.START,this._onMouseDownDelay,this),this._map.off("click",this._onClickDelay))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._removePoly(),this._map.dragging&&this._map.dragging.enable(),L.DomEvent.off(this._map._container,L.Handler.SelectRectangle.START,this._onMouseDownDelay),L.DomEvent.off(this._map._container,L.Handler.SelectRectangle.END,this._onMouseUp),L.DomEvent.off(this._map._container,L.Handler.SelectRectangle.MOVE,this._onMouseMove));
L.Handler.SelectPoint.prototype.removeHooks.call(this)},_onMouseDown:function(a){this._beginLatLng=a},_onMouseDownDelay:function(a){L.DomEvent.stop(a);L.DomEvent.on(this._map._container,L.Handler.SelectRectangle.END,this._onMouseUp,this);L.DomEvent.on(this._map._container,L.Handler.SelectRectangle.MOVE,this._onMouseMove,this);this._mouseDelay&&clearTimeout(this._mouseDelay);var b=this._map.mouseEventToLatLng(a.touches&&0<a.touches.length?a.touches[0]:a);this._mouseDelay=setTimeout(L.Util.bind(function(){this._onMouseDown(b)},
this),150)},_onMouseMove:function(a){L.DomEvent.stop(a);this._beginLatLng&&this._updatePolyBounds(this._map.mouseEventToLatLng(a.touches&&0<a.touches.length?a.touches[0]:a))},_onMouseUp:function(a){delete this._beginLatLng;L.DomEvent.off(this._map._container,L.Handler.SelectRectangle.END,this._onMouseUp);L.DomEvent.off(this._map._container,L.Handler.SelectRectangle.MOVE,this._onMouseMove);this._poly?(this._map.fire("select:bounds",{geoJSON:this._poly.toGeoJSON(),originalEvent:a}),this._removePoly()):
this._onClickDelay({containerPoint:this._map.mouseEventToContainerPoint(a.touches&&0<a.touches.length?a.touches[0]:a),originalEvent:a})},_removePoly:function(){this._poly&&(this._map.removeLayer(this._poly),delete this._poly);delete this._beginLatLng},_updatePolyBounds:function(a){a=new L.LatLngBounds(this._beginLatLng,a);this._poly?this._poly.setBounds(a):(this._poly=new L.Rectangle(a,this.options.shapeOptions),this._map.addLayer(this._poly))}});L.SelectionStack=L.Class.extend({includes:L.Mixin.Events,options:{selectionId:null,tileSetId:null,labelField:null,selectionUrlTemplate:null,append:null},initialize:function(a){L.Util.setOptions(this,a);this._id=this._generateInternalId(10);this.addedIds=[];this.spatialOperations=[];this.suppressedIds=[];this.unsuppressedIds=[]},addOperation:function(a,b){return!a?this:"Suppress"==a.type||"Add"==a.type?this.addIdOperation(a,b):this.addSpatialOperation(a,b)},addOperations:function(a){for(var b=0,c=
a.length;b<c;b++)this.addOperation(a[b],!1);this._updated();return this},addSpatialOperation:function(a,b){if(!a||"Click"!=a.type&&"Area"!=a.type)return this;this.spatialOperations.push(a);!1!==b&&this._updated();return this},addIdOperation:function(a,b){if(!a||"Suppress"!=a.type&&"Add"!=a.type)return this;var c=a.addIds||a.value,d=a.dropIds;"Suppress"==a.type?(this._updateIdList(this.unsuppressedIds,this.suppressedIds,d),this._updateIdList(this.suppressedIds,this.unsuppressedIds,c),this._updateIdList(null,
this.addedIds,c)):"Add"==a.type&&(this._updateIdList(this.addedIds,this.suppressedIds,c),this._updateIdList(null,this.addedIds,d),this._updateIdList(null,this.unsuppressedIds,c));!1!==b&&this._updated();return this},clear:function(a){if(0===this.spatialOperations.length&&0===this.suppressedIds.length&&0===this.addedIds.length)return this;this.spatialOperations=[];this.suppressedIds=[];this.unsuppressedIds=[];this.addedIds=[];!1!==a&&this._updated();return this},deserialize:function(a){var a=(a||"").split("\n"),
b;this.clear(!1);for(var c=0,d=a.length;c<d;c++)b=a[c].split("="),this.addOperation({type:b[0],value:b[1]},!1);this._updated();return this},destroy:function(){this.store||L.SelectionStack.Queue.remove(this);this._updatedTimeout&&(clearTimeout(this._updatedTimeout),delete this._updatedTimeout);this.off("store:success").off("store:error").off("store:delay").off("search:success").off("search:error").off("search:delay");delete this.spatialOperations;delete this.suppressedIds;delete this.unsuppressedIds;
delete this.addedIds},getAllOperations:function(){for(var a=[],b=this.spatialOperations,c=0,d=b.length;c<d;c++)a.push(b[c]);this.suppressedIds&&0<this.suppressedIds.length&&a.push({type:"Suppress",value:this.suppressedIds});this.addedIds&&0<this.addedIds.length&&a.push({type:"Add",value:this.addedIds});return a},getIdIndex:function(a,b){if(b){if(b.indexOf)return b.indexOf(a);var c,d=b.length;for(c=0;c<d;c++)if(b[c]==a)return c}return-1},getSelectedIds:function(){var a,b,c=[];if(this.unsuppressedIds&&
0<this.unsuppressedIds.length){b=this.unsuppressedIds.length;for(a=0;a<b;a++)c.push(this.unsuppressedIds[a])}if(this.addedIds&&0<this.addedIds.length){b=this.addedIds.length;for(a=0;a<b;a++)0>this.getIdIndex(this.addedIds[a],c)&&c.push(this.addedIds[a])}return c},getTypes:function(){var a={},b=[],c=this.getAllOperations(),d,e,f=c.length;for(d=0;d<f;d++)a[c[d].type]=!0;for(e in a)a.hasOwnProperty(e)&&!0===a[e]&&b.push(e);return b},isIdSelected:function(a){return-1<this.getIdIndex(a.toString(),this.addedIds)||
-1<this.getIdIndex(a.toString(),this.unsuppressedIds)},isIdSuppressed:function(a){return-1<this.getIdIndex(a.toString(),this.suppressedIds)},merge:function(a){return this.addOperations(a.getAllOperations())},search:function(){L.SelectionStack.Queue.push(this)},serialize:function(){for(var a=[],b=this.getAllOperations(),c,d=0,e=b.length;d<e;d++)c=b[d],a.push(c.type+"="+c.value);return a.join("\n")},_finishUpdating:function(){this._updating=!1;this._needsUpdating&&this._store()},_generateInternalId:function(a){for(var b=
"",c=0;c<a;c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b},_onSearchDelay:function(){this.fire("search:delay",{stack:this})},_onSearchError:function(a,b){this.fire("search:error",{stack:this,data:a,request:b})},_onSearchSuccess:function(a){this.fire("search:success",{stack:this,data:a})},_onStoreDelay:function(){this.fire("store:delay",{stack:this})},_onStoreError:function(a,b){this.fire("store:error",{stack:this,data:a,request:b});
this._finishUpdating()},_onStoreSuccess:function(a){this.options.selectionId=a.selectionId;var b=a.records,c=[];if(b&&0<b.length){for(var d=0,e=b.length;d<e;d++)c.push(b[d][0]);this.addOperation({type:"Suppress",dropIds:c},!1)}this.fire("store:success",{stack:this,data:a});this._finishUpdating()},_request:function(a,b,c,d){d={tileSetId:this.options.tileSetId,"return":"OverviewAndRecords",storeSelection:d};this.options.labelField&&(d.labelField=this.options.labelField);this.options.selectionId&&(d.dropSelectionId=
this.options.selectionId);var e=this.serialize();e&&""!=e&&(d.operationStack=e);L.Util.ajax(this.options.selectionUrlTemplate,{method:"POST",data:d,success:a,error:b,delay:c,delayTime:500,context:this})},_search:function(){this.options.tileSetId&&""!=this.options.tileSetId&&this._request(this._onSearchSuccess,this._onSearchError,this._onSearchDelay,!1)},_store:function(){!this.options.tileSetId||""==this.options.tileSetId||this._updating?this._updating&&(this._needsUpdating=!0):(this._needsUpdating=
!1,this._updating=!0,this._request(this._onStoreSuccess,this._onStoreError,this._onStoreDelay,!0))},_updated:function(){this._updatedTimeout&&(clearTimeout(this._updatedTimeout),delete this._updatedTimeout);this._updatedTimeout=setTimeout(L.Util.bind(this._updatedDelay,this),50)},_updatedDelay:function(){this.fire("updated",{stack:this});!0===this.options.store&&this._store()},_updateIdList:function(a,b,c){var d,e;if((c="string"==typeof c?c.split(","):c)&&0<c.length)for(var f=0,g=c.length;f<g;f++)d=
c[f].toString(),b&&(e=this.getIdIndex(d,b),-1<e&&b.splice(e,1)),a&&0>this.getIdIndex(d,a)&&a.push(d)}});L.SelectionStack.Queue={queue:[],push:function(a){this.queue.push(a);1===this.queue.length&&this.processNext()},remove:function(a){for(var b=this.queue.length;b--;)if(this.queue[b]._id==a._id){this.queue.splice(b,1);this.processNext();break}},shift:function(){this.queue.shift();this.processNext()},processNext:function(){0<this.queue.length&&this.queue[0]._search()}};L.Handler.Edit=L.Handler.extend({includes:L.Mixin.Events,feature:null,options:{marker:new L.divIcon({className:"edit-marker",iconSize:L.Browser.touch?[39,39]:[23,23]})},initialize:function(a,b){this._map=a;this._container=a._container;L.Util.extend(this.options,b)},enable:function(a){this.feature=a;this.fire("activated");L.Handler.prototype.enable.call(this)},disable:function(){this.fire("deactivated");L.Handler.prototype.disable.call(this)},cancel:function(){var a=this.feature;this._featureChanged&&
this._latLngCache&&(a.setLatLngs(this._latLngCache),this._map.fire("edit:feature-changed",{feature:a}));this.disable()},addHooks:function(){if(this._map){L.DomUtil.disableTextSelection();L.DomEvent.on(window,"keyup",this._onKeyUp,this);this._initFeatureHandles();this.feature.disableLabel();var a;"point"==this.feature.options.type?a=(L.Browser.touch?"Tap":"Click")+" and drag the point to move it.":(a=(L.Browser.touch?"Tap":"Click")+" and drag the markers to modify the feature.",setTimeout(L.Util.bind(function(){if(this._map)this._map.on("click",
this.finishShape,this)},this),100));this.fire("help-updated",{content:a})}},removeHooks:function(){delete this._featureChanged;this._map&&(L.DomUtil.enableTextSelection(),L.DomEvent.off(window,"keyup",this._onKeyUp,this),this._removeFeatureHandles(),this._polyMarkers&&delete this._polyMarkers,this._latLngCache&&delete this._latLngCache,this.feature.enableLabel(),"point"!==this.feature.options.type&&this._map.off("click",this.finishShape))},finishShape:function(){this._featureChanged&&this._map&&this._map.fire("edit:feature-changed",
{feature:this.feature});this.disable()},_buildPolyMarker:function(a,b,c){a=(new L.Marker(a,{draggable:!0,idx:b,virtual:c,icon:this.options.marker})).addTo(this._map).on("dragstart",this._onPolyMarkerDragStart,this).on("drag",this._onPolyMarkerDrag,this).on("dragend",this._onPolyMarkerDragEnd,this);this._polyMarkers.push(a)},_buildPolyMarkers:function(){this._polyMarkers=[];var a=this.feature.getLatLngs(),b,c,d,e=a.length,f=this.feature.options.type,g=this._map;for(b=0;b<e;b++){c=a[b];if(b||"polygon"==
f)d=d||g.project(a[(b||e)-1]),point=g.project(c),this._buildPolyMarker(g.unproject([(d.x+point.x)/2,(d.y+point.y)/2]),b,!0),d=point;this._buildPolyMarker(c,b,!1)}},_clearPolyMarkers:function(){var a=this._polyMarkers,b,c=a.length,d,e=this._map;for(b=0;b<c;b++)d=a[b],d.off("dragstart",this._onPolyMarkerDragStart).off("drag",this._onPolyMarkerDrag).off("dragend",this._onPolyMarkerDragEnd),e.removeLayer(d);this._polyMarkers=[]},_clearVirtualPolyMarkers:function(){var a=this._polyMarkers,b,c,d=this._map;
for(b=a.length;b--;)c=a[b],c.options.virtual&&(d.removeLayer(c),a.splice(b,1))},_initFeatureHandles:function(){var a=this.feature;"point"==a.options.type?(a.dragging&&a.dragging.enable(),a.on("dragstart",this._onMarkerDragStart,this),a.on("dragend",this._onMarkerDragEnd,this)):(this._latLngCache=a.getLatLngs().slice(0),this._buildPolyMarkers())},_onKeyUp:function(a){27===a.keyCode?this.cancel():13===a.keyCode&&this.finishShape()},_onMarkerDragEnd:function(){this.finishShape()},_onMarkerDragStart:function(){this._featureChanged=
!0},_onPolyMarkerDrag:function(a){a=a.target;this.feature.spliceLatLngs(a.options.idx,1,a.getLatLng())},_onPolyMarkerDragEnd:function(){this._clearPolyMarkers();this._buildPolyMarkers();this._map.fire("edit:feature-changed",{feature:this.feature});this.fire("help-updated",{content:(L.Browser.touch?"Tap":"Click")+" done when you're finished."})},_onPolyMarkerDragStart:function(a){this._featureChanged=!0;a=a.target;a.options.virtual&&(this.feature.spliceLatLngs(a.options.idx,0,a.getLatLng()),a.options.virtual=
!1);this._clearVirtualPolyMarkers()},_removeFeatureHandles:function(){var a=this.feature;"point"==a.options.type?(a.dragging&&a.dragging.disable(),a.off("dragstart",this._onMarkerDragStart),a.off("dragend",this._onMarkerDragEnd)):this._clearPolyMarkers()}});L.Dialog={};
L.Control.Dialog=L.Class.extend({options:{type:"dialog"},initialize:function(a,b){this._map=a;this._container=a._container;L.Util.setOptions(this,b);this.element=L.DomUtil.create("div","leaflet-control-dialog",this._container);L.DomEvent.on(this.element,"click",L.DomEvent.stopPropagation);L.DomEvent.on(this.element,"dblclick",L.DomEvent.stopPropagation);L.DomUtil.create("div","background",this.element);this._dialog=L.DomUtil.create("div","dialog",this.element);this.options.title&&(L.DomUtil.create("h2",null,
this._dialog).innerHTML=this.options.title);this.options.content&&(L.DomUtil.create("span","content",this._dialog).innerHTML=this.options.content);this._map.dragging.disable();this._map.scrollWheelZoom&&this._map.scrollWheelZoom.disable()},destroy:function(){this.element&&(L.DomEvent.off(this.element,"click",L.DomEvent.stopPropagation),L.DomEvent.off(this.element,"dblclick",L.DomEvent.stopPropagation),this._map.scrollWheelZoom&&this._map.scrollWheelZoom.enable(),this._map.dragging.enable(),this._dialog&&
(this.element.removeChild(this._dialog),delete this._dialog),this.element.innerHTML="",this._container.removeChild(this.element),delete this.element,delete this._map,delete this._container)},_addButton:function(a,b,c,d,e,f){var g;try{g=document.createElement('<button type="'+(f||"button")+'">')}catch(h){g=document.createElement("button"),g.setAttribute("type",f||"button")}g.innerHTML=a;c.appendChild(g);L.DomEvent.on(g,"click",L.DomEvent.stopPropagation).on(g,"mousedown",L.DomEvent.stopPropagation).on(g,
"dblclick",L.DomEvent.stopPropagation);if(d)L.DomEvent.on(g,"click",d,e)}});L.Dialog.Action=L.Control.Dialog.extend({options:{type:"action"},initialize:function(a,b){L.Control.Dialog.prototype.initialize.call(this,a,b);if(this.options.buttons)for(var c,d=0;d<this.options.buttons.length;d++)c=this.options.buttons[d],this._addButton(c.label,c.className,this._dialog,c.callback,c.context);this._addButton(this.options.cancelText?this.options.cancelText:"Cancel","cancel",this._dialog)},_addButton:function(a,b,c,d,e,f){L.Control.Dialog.prototype._addButton.call(this,a,b,c,function(a){L.DomEvent.stop(a);
d&&d.call(e,a);this.destroy()},this,f)}});L.Dialog.Alert=L.Control.Dialog.extend({initialize:function(a,b){L.Control.Dialog.prototype.initialize.call(this,a,b);this._addButton("OK","ok",this._dialog,this._onOkClick,this)},_onOkClick:function(){this.destroy()}});L.Dialog.Loading=L.Control.Dialog.extend({initialize:function(a,b){L.Control.Dialog.prototype.initialize.call(this,a,b);L.DomEvent.on(this.element,"click",L.DomEvent.stop);L.DomEvent.on(this.element,"dblclick",L.DomEvent.stop);L.DomEvent.on(this.element,"mousedown",L.DomEvent.stop);this._map.dragging&&this._map.dragging.disable();L.DomUtil.create("div","loading",this._dialog).innerHTML=this.options.msg},destroy:function(){this._map.dragging&&this._map.dragging.enable();L.DomEvent.off(this.element,
"click",L.DomEvent.stop);L.DomEvent.off(this.element,"dblclick",L.DomEvent.stop);L.DomEvent.off(this.element,"mousedown",L.DomEvent.stop);L.Control.Dialog.prototype.destroy.call(this)}});L.Dialog.Prompt=L.Control.Dialog.extend({initialize:function(a,b){L.Control.Dialog.prototype.initialize.call(this,a,b);this._map&&(this._map.dragging&&this._map.dragging.disable(),this._map.keyboard&&this._map.keyboard.disable());var c=L.DomUtil.create("form","",this._dialog);L.DomEvent.on(c,"submit",this._onFormSubmit,this);var d=L.DomUtil.create("div","input_wrapper"),e=L.DomUtil.create("label","");e.setAttribute("for","text_input");e.innerHTML=this.options.label;var f=L.DomUtil.create("input",
"");f.type="text";f.id="text_input";f.name="text_input";f.value=b.value||"";d.appendChild(e);d.appendChild(f);c.appendChild(d);f.focus();f.select();this.inputElm=f;this._addButton("Save","save",c,null,null,"submit");this._addButton("Cancel","cancel",c)},destroy:function(){this._map&&(this._map.dragging&&this._map.dragging.enable(),this._map.keyboard&&this._map.keyboard.enable());L.Control.Dialog.prototype.destroy.call(this)},_addButton:function(a,b,c,d,e,f){var g=function(){},h=e;"submit"!=f&&(g=
function(a){d&&d.call(e,a);this.destroy()},h=this);L.Control.Dialog.prototype._addButton.call(this,a,b,c,g,h,f)},_onFormSubmit:function(a){a&&L.DomEvent.stop(a);if(a=this.inputElm)this.options.callback&&this.options.callback(a.value),this.destroy()}});L.Dialog.Select=L.Control.Dialog.extend({options:{type:"select"},initialize:function(a,b){L.Control.Dialog.prototype.initialize.call(this,a,b);L.DomUtil.addClass(this._dialog,"select");L.DomUtil.addClass(this._dialog,this.options.multiple?"multiple":"single");L.DomEvent.on(this.element,"click",L.DomEvent.stopPropagation);L.DomEvent.on(this.element,"dblclick",L.DomEvent.stopPropagation);this._buildList(b.options);this._addButton("Done","done",this._dialog,this._onDoneClick,this,"submit");this._addButton("Cancel",
"cancel",this._dialog,this._onCancelClick,this)},destroy:function(){this._dialog&&this._list&&(L.DomEvent.off(this._list,"click",this._onListClick),this._dialog.removeChild(this._list),delete this._list);L.Control.Dialog.prototype.destroy.call(this)},_addButton:function(a,b,c,d,e,f){L.Control.Dialog.prototype._addButton.call(this,a,b,c,function(a){L.DomEvent.stop(a);d&&d.call(e,a);this.destroy()},this,f)},_buildList:function(a){var b=[],c,d,e,f=this.options.multiple,g;if(f){e=L.DomUtil.create("div",
"toggle_all",this._dialog);var h=document.createElement("input");h.type="checkbox";h.name="toggle_all";h.id="toggle_all";this.toggleLabel=document.createElement("label");this.toggleLabel.setAttribute("for","toggle_all");this.toggleLabel.innerHTML="Check All";e.appendChild(h);e.appendChild(this.toggleLabel);L.DomEvent.on(h,"click",this._onToggleAllClick,this)}this._list=L.DomUtil.create("ul","",this._dialog);L.DomEvent.on(this._list,"click",this._onListClick,this);for(h=0;h<a.length;h++)c=a[h],d=c.key,
e=c.label,c=c.checked,g="record_"+d,d=f?'<input type="checkbox" name="'+g+'" id="'+g+'" value="'+d+'"'+(c?' checked="checked"':"")+" />":'<input type="radio" name="selection" id="'+g+'" value="'+d+'"'+(c?' checked="checked"':"")+" />",e='<label for="'+g+'">'+e+"</label>",b.push("<li"+(c?' class="active"':"")+">"+d+e+"</li>");this._list.innerHTML=b.join("")},_clearSelection:function(){for(var a=this._list.getElementsByTagName("li"),b,c=0;c<a.length;c++)b=a[c],"active"==b.className&&(b.className="",
b.getElementsByTagName("input")[0].checked=!1)},_clickDelegate:function(a){var b=a.target||a.srcElement;if(!b)return!0;if("LABEL"===b.tagName){b=b.getAttribute("for")||b.htmlFor;if(!b)return!0;document.getElementById(b).click();L.DomEvent.preventDefault(a);return!0}return!1},_onCancelClick:function(){this.options.callback&&this.options.callback([],[])},_onDoneClick:function(){for(var a=[],b=[],c=this._list.getElementsByTagName("input"),d,e=0;e<c.length;e++)d=c[e],d.checked?a.push(d.value):b.push(d.value);
this.options.callback&&this.options.callback(a,b)},_onListClick:function(a){this._clickDelegate(a)||(a=a.target||a.srcElement,"INPUT"===a.tagName&&(this.options.multiple||this._clearSelection(),a.checked?L.DomUtil.addClass(a.parentNode,"active"):L.DomUtil.removeClass(a.parentNode,"active")))},_onToggleAllClick:function(a){this._clickDelegate(a)||(a=a.target||a.srcElement,"INPUT"===a.tagName&&(a.checked?(L.DomUtil.addClass(a.parentNode,"active"),this.toggleLabel.innerHTML="Uncheck All",this._selectAll()):
(L.DomUtil.removeClass(a.parentNode,"active"),this.toggleLabel.innerHTML="Check All",this._clearSelection())))},_selectAll:function(){for(var a=this._list.getElementsByTagName("li"),b,c=0;c<a.length;c++)b=a[c],"active"!=b.className&&(b.className="active",b.getElementsByTagName("input")[0].checked=!0)}});L.Control.Zoomslider=L.Control.extend({options:{position:"bottomright",stepHeight:11},onAdd:function(a){this._map=a;a=L.DomUtil.create("div","leaflet-control-zoomslider");L.DomEvent.disableClickPropagation(a);this._zoomInButton=this._createButton("Zoom In","leaflet-control-zoomslider-in",a,this._zoomInClick,this);this._createSlider(a);this._zoomOutButton=this._createButton("Zoom Out","leaflet-control-zoomslider-out",a,this._zoomOutClick,this);this._map.on("zoomend",this._onZoomEnd,this);this._map.on("layeradd layerremove resized",
this._setZoomRange,this);return a},onRemove:function(){this._map.off("zoomend",this._onZoomEnd)},_createButton:function(a,b,c,d,e){b=L.DomUtil.create("a",b,c);b.href="#";b.title=a;L.DomEvent.on(b,"click",L.DomEvent.preventDefault).on(b,"click",d,e);return b},_createHandle:function(a){this._handle=L.DomUtil.create("div","handle",a);L.DomUtil.setPosition(this._handle,L.point(0,0));L.DomEvent.disableClickPropagation(this._handle);a=new L.Bounds(L.point(0,0),L.point(0,this._rangeHeight));a=(new L.BoundedDraggable(this._handle,
this._handle,a)).on("drag",this._onHandleDrag,this);a.enable();return a},_createSlider:function(a){this._slider=L.DomUtil.create("div","wrap",a);this._range=L.DomUtil.create("div","range",this._slider);L.DomEvent.on(this._range,"click",this._onSliderClick,this);this._setZoomRange();this._draggable=this._createHandle(this._range)},_onHandleDrag:function(){var a=L.DomUtil.getPosition(this._handle).y,b=this._positionToZoom(a);this._snapHandleToZoom(b);this._dragTimeout&&(clearTimeout(this._dragTimeout),
delete this._dragTimeout);this._dragTimeout=setTimeout(L.Util.bind(function(){this._map.setZoom(b)},this),100)},_onSliderClick:function(a){a=a.touches&&1===a.touches.length?a.touches[0]:a;a=a.offsetY?a.offsetY:L.DomEvent.getMousePosition(a).y-L.DomUtil.getViewportOffset(this._handle).y;a=this._positionToZoom(a-this._handle.offsetHeight/2);this._map.setZoom(a)},_onZoomEnd:function(){this._snapHandleToZoom(this._map.getZoom())},_positionToZoom:function(a){return Math.max(Math.round((this._rangeHeight-
a)/this.options.stepHeight),0)+this._minZoom},_setZoomRange:function(){var a=this._map.getMinZoom(),b=this._map.getMaxZoom(),c=!1;if(this._maxZoom||this._minZoom)if(c=!0,this._maxZoom==b&&this._minZoom==a)return;this._minZoom=a;this._maxZoom=b;this._rangeHeight=Infinity==b-a?0:(b-a)*this.options.stepHeight;this._range.style.height=this._rangeHeight+this.options.stepHeight+"px";this._draggable&&(this._draggable._bounds=new L.Bounds(L.point(0,0),L.point(0,this._rangeHeight)));c&&this._snapHandleToZoom(this._map.getZoom())},
_snapHandleToZoom:function(a){if("undefined"!=typeof a){var b=this._map;this._updateZoomButtons(a);a=this._rangeHeight-(a-b.getMinZoom())*this.options.stepHeight;L.DomUtil.setPosition(this._handle,L.point(0,a))}},_updateZoomButtons:function(a){var b=this._map,a=a||b.getZoom(),c=b.getMinZoom(),b=b.getMaxZoom();a==c?L.DomUtil.addClass(this._zoomOutButton,"disabled"):L.DomUtil.removeClass(this._zoomOutButton,"disabled");a==b?L.DomUtil.addClass(this._zoomInButton,"disabled"):L.DomUtil.removeClass(this._zoomInButton,
"disabled")},_zoomInClick:function(){this._map.zoomIn(1)},_zoomOutClick:function(){this._map.zoomOut(1)}});L.Map.mergeOptions({zoomControl:!1,zoomsliderControl:!0});L.Map.addInitHook(function(){this.options.zoomsliderControl&&L.control.zoomslider().addTo(this)});L.control.zoomslider=function(a){return new L.Control.Zoomslider(a)};
L.BoundedDraggable=L.Draggable.extend({initialize:function(a,b,c){L.Draggable.prototype.initialize.call(this,a,b);this._bounds=c;this.on("predrag",function(){this._bounds.contains(this._newPos)||(this._newPos=this._fitPoint(this._newPos))},this)},_fitPoint:function(a){a=L.point(Math.min(a.x,this._bounds.max.x),Math.min(a.y,this._bounds.max.y));a.x=Math.max(a.x,this._bounds.min.x);a.y=Math.max(a.y,this._bounds.min.y);return a}});L.Control.Locate=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",follow:!1,metric:!0},onAdd:function(a){this._map=a;a=L.DomUtil.create("div","leaflet-control-locate");this._locateOptions={setView:!1,watch:!0};this._locateOnNextLocationFound=!0;this._active=this._atLocation=!1;var b=L.DomUtil.create("a","leaflet-control-locate",a);b.href="#";b.title="Center map on my physical location";L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,
"click",this._onClick,this).on(b,"dblclick",L.DomEvent.stopPropagation);this._map.on("locationfound",this._onLocationFound,this).on("locationerror",this._onLocationError,this).on("movestart",this._onMoveStart,this);return a},onRemove:function(a){a.off("locationfound",this._onLocationFound).off("locationerror",this._onLocationError).off("movestart",this._onMoveStart)},_onClick:function(){this._atLocation&&this._active?this._removeVisualization():(this._locateOnNextLocationFound=this._active=!0,this._location?
this._setLocation(this._location):(L.DomUtil.addClass(this._container,"requesting"),this._map.locate(this._locateOptions)))},_onLocationFound:function(a){if(this._location&&(this._location.latlng.lat!=a.latlng.lat||this._location.latlng.lon!=a.latlng.lon))this._atLocation=!1;this._location=a;this._active&&(this.options.follow&&(this._locateOnNextLocationFound=!0),this._setLocation(a))},_onLocationError:function(a){3==a.code&&this._locateOptions.watch||(this._removeVisualization(),this._map&&this._map.stopLocate(),
alert(a.message))},_onMoveStart:function(){this._atLocation=!1},_removeVisualization:function(){L.DomUtil.removeClass(this._container,"requesting");this._active=!1},_setLocation:function(a){this._locateOnNextLocationFound&&(this._map&&(this._map.fitBounds(a.bounds),this._map.fire("locate:location-set",{location:a})),this._atLocation=!0,this._locateOnNextLocationFound=!1);this._container&&L.DomUtil.removeClass(this._container,"requesting")}});
L.Map.addInitHook(function(){this.options.locateControl&&(this.locateControl=L.control.locate(),this.addControl(this.locateControl))});L.control.locate=function(a){return new L.Control.Locate(a)};L.Control.LayerToggle=L.Control.extend({includes:L.Mixin.Events,options:{position:"topright"},onAdd:function(a){this._map=a;this._layers={};a=L.DomUtil.create("div","leaflet-control-layertoggle");this._link=L.DomUtil.create("a","",a);this._link.href="#";this._link.title="View Layer Settings";L.DomEvent.on(this._link,"click",this._onClick,this);L.DomEvent.on(a,"dblclick",L.DomEvent.stopPropagation);this.layerContainer=L.DomUtil.create("ul","layers",a);L.DomEvent.on(this.layerContainer,"click",this._onListClick,
this);return a},onRemove:function(){this._map&&delete this._map;this._layers&&delete this._layers;this.layerContainer&&(L.DomEvent.off(this.layerContainer,"click",this._onListClick),delete this.layerContainer);this._updateTimeout&&(clearTimeout(this._updateTimeout),delete this._updateTimeout)},addLayer:function(a){this._layers[a.name]||(this._layers[a.name]=a,this._updateList())},hideLayer:function(a){this._map&&(this._layers[a.name]&&this._map.hasLayer(a.obj))&&(this._map.removeLayer(a.obj),this._updateList())},
removeLayer:function(a){this._layers[a.name]&&(this.hideLayer(a),delete this._layers[a.name],this._updateList())},showLayer:function(a){this._map&&(this._layers[a.name]&&!this._map.hasLayer(a.obj))&&(this._map.addLayer(a.obj),this._updateList())},_getLayerZIndex:function(a){return a.obj&&a.obj.options&&a.obj.options.zIndex?a.obj.options.zIndex:-1},_getSortedLayers:function(){var a,b=[],c,d,e;for(e in this._layers)if(this._layers.hasOwnProperty(e)){a=this._layers[e];d=this._getLayerZIndex(a);c=0;if(-1<
d)for(var f=b.length;f--;)d<=this._getLayerZIndex(b[f])&&(c=f+1);b.splice(c,0,a)}return b},_onClick:function(a){L.DomEvent.stop(a);L.DomUtil.hasClass(this._link,"active")?L.DomUtil.removeClass(this._link,"active"):L.DomUtil.addClass(this._link,"active")},_onListClick:function(a){L.DomEvent.stop(a);if(a=a.target||a.srcElement)if("LABEL"===a.tagName)(a=a.getAttribute("for")||a.htmlFor)&&document.getElementById(a).click();else if("INPUT"===a.tagName){var b=this._layers[a.id];b&&(a.checked?this.showLayer(b):
this.hideLayer(b))}},_updateList:function(){this._updateTimeout&&clearTimeout(this._updateTimeout);this._updateTimeout=setTimeout(L.Util.bind(this._updateListDelay,this),100)},_updateListDelay:function(){if(this._map){var a,b,c,d=this._getSortedLayers(),e,f=[];this.layerContainer.innerHTML="";for(var g=0,h=d.length;g<h;g++)e=d[g],c=this._map.hasLayer(e.obj),f.push('"'+e.name.toLowerCase()+'":'+(c?"true":"false")),a=L.DomUtil.create("li",c?"active":"",this.layerContainer),b=document.createElement("input"),
b.type="checkbox",b.name=e.name,b.id=e.name,b.defaultChecked=c,a.appendChild(b),a=L.DomUtil.create("label","",a),a.setAttribute("for",e.name),a.innerHTML=e.name;f="{"+f.join(",")+"}";this.fire("layer:settings-changed",{settings:f})}}});L.Util.ajax=function(a,b){var c,d=new function(){try{return new window.XMLHttpRequest}catch(a){try{return new ActiveXObject("Microsoft.XMLHTTP.6.0")}catch(b){try{return new ActiveXObject("Microsoft.XMLHTTP.3.0")}catch(c){throw Error("XMLHttpRequest is not supported");}}}},e=(b.method||"GET").toUpperCase(),f=b.success||function(){},g=b.error||function(){},h=b.context,i,m=b.delay,j;if(b.data){i=b.data;var n=[],k,l;for(l in i)k=i[l],k=null!==k?k:"",n.push(encodeURIComponent(l)+"="+encodeURIComponent(k));
i=n.join("&")}m&&0<j&&(j=setTimeout(m,j));var p={url:a,data:i};d.open(e,a);d.onreadystatechange=function(){if(4===d.readyState){j&&(clearTimeout(j),j=null);if(window.JSON)try{c=JSON.parse(d.responseText)}catch(a){c=d.responseText}else try{c=eval("("+d.responseText+")")}catch(b){c=d.responseText}200===d.status?f.call(h||this,c,p):g.call(h||this,c,p);d.onreadystatechange=null}};d.setRequestHeader("Content-type","text/plain; charset=UTF-8");if("undefined"!==typeof jQuery&&jQuery.ajaxSettings&&(e=jQuery.ajaxSettings.headers))for(var q in e)d.setRequestHeader(q,
e[q]);d.send(i)};
(function(){AlteryxJS={Class:function(){var a=function(){this.initialize.apply(this,arguments)};if(arguments&&0<arguments.length){var b=null,c=null;if(1<arguments.length){var b=arguments[0],c=arguments[1],d=function(){};d.prototype=b.prototype;a.prototype=new d;b.subclasses.push(a)}else c=arguments[0];a.subclasses=[];a.superclass=b;for(var e in c)a.prototype[e]=c[e];a.prototype.applyProperties=function(a){if(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&
(this[c]=b[c])}};a.prototype.derivesFrom=function(b){return a.__className===b?!0:a.superclass?a.superclass.prototype.derivesFrom(b):!1};c.CLASS_NAME&&(a.__className=c.CLASS_NAME)}if(!a.prototype.initialize)throw"A valid initialize method was not found!";return a}}})();(function(){AlteryxJS.Comm=AlteryxJS.Class({_registry:{},options:{},initialize:function(a){this._registry={};this.options=a},fire:function(a,b){var c=this._registry[a];if(!c)return this;var d,e=c.length;for(d=0;d<e;d++)c[d].context&&c[d].callback.call?c[d].callback.call(c[d].context,b):c[d].callback(b);return this},on:function(a,b,c){var d=this._registry[a];d||(d=this._registry[a]=[]);d.push({callback:b,context:c});return this},off:function(a,b){var c=this._registry[a];if(c){for(var d=c.length;d--;)c[d].callback===
b&&c.splice(d,1);return this}}})})();(function(){AlteryxJS.Util={getQueryParameter:function(a){return(a=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(a[1].replace(/\+/g," "))},escapeHtml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},escapeJson:function(a){return a.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")}}})();(function(){AlteryxJS.Comm.WindowExt=AlteryxJS.Class(AlteryxJS.Comm,{fire:function(a,b){var c=this._registry[a];if(!c)return this;var d,e=c.length;for(d=0;d<e;d++)if("string"===typeof c[d].callback)window.external[c[d].callback](b);else c[d].callback.call&&c[d].callback.call(c[d].context,b);return this}});ExecuteJsWrapper=function(){var a=function(b,c){var f=c.split("."),g=f.shift();return 0<f.length?a(b[g],f.join(".")):{base:b,method:b[g]}},b=arguments,c=Array.prototype.splice.call(b,0,1)[0],c=a(window,
c);c.method.apply(c.base,b)}})();(function(){AlteryxJS.Map=AlteryxJS.Class({options:{layerUrlTemplate:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",selectionUrlTemplate:"http://localhost:80/AlteryxService/MapTile/Selection/",layerOptions:{base:!0,reference:!0,selection:!0,labels:!0,"drawn features":!0},subdomains:null,geolocate:!1,mode:null,name:null,baseTileSetId:null,referenceTileSetId:null,labelField:null},input:null,bounds:{},layers:{},modeControl:null,featureOptions:{point:{icon:new L.Icon.Default,type:"point"},linestring:{stroke:!0,
color:"#05f",weight:12,opacity:0.5,fill:!1,clickable:!0,type:"polyline"},polygon:{stroke:!0,color:"#05f",weight:6,opacity:0.6,fill:!0,fillColor:"#0af",fillOpacity:0.5,clickable:!0,type:"polygon"}},initialize:function(a,b){this.options={layerUrlTemplate:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",selectionUrlTemplate:"http://localhost:80/AlteryxService/MapTile/Selection/",layerOptions:{base:!0,reference:!0,selection:!0,labels:!0,"drawn features":!0},subdomains:null,geolocate:!1,mode:null,name:null,
baseTileSetId:null,referenceTileSetId:null,labelField:null};this.input=null;this.bounds={};this.layers={};this.modeControl=null;this.maxBounds=new L.LatLngBounds(new L.LatLng(-90,-180,!0),new L.LatLng(90,180,!0));this._element=a;this.map=L.map(this._element,{minZoom:3,maxZoom:20,maxBounds:this.maxBounds,worldCopyJump:!1,boxZoom:!0});this._toggleControl=new L.Control.LayerToggle;this._toggleControl.on("layer:settings-changed",this._onLayerSettingsChanged,this).addTo(this.map);this.modeControl=null;
this.createLayers(b);this.setOptions(b)},addFeatures:function(a){if(a){var b,c=a.length,d,e;for(b=0;b<c;b++)if(d=a[b])e=this.convertGeoJson(d.pop()),0<d.length&&(e.options.label=d[0]),this.modeControl.addFeature(e,!1);this.updateValue(!1)}},buildInputField:function(){if(!this.input){if(!this.options.name||""===this.options.name)this.options.name="mapQuestionAnswer";this.input=document.createElement("input");this.input.type="hidden";this.input.id=this.options.name;this.input.name=this.options.name;
this.input.className="mapQuestion";document.getElementById(this._element).parentNode.appendChild(this.input)}},convertGeoJson:function(a){var a="string"==typeof a?eval("("+a+")"):a,b=this.featureOptions;a.type=a.type.toLowerCase();switch(a.type){case "point":return new L.Marker(this._flipCoordinates(a.coordinates),b.point);case "linestring":return new L.Polyline(this._flipLineString(a.coordinates),b.linestring);case "polygon":return new L.Polygon(this._flipLineString(a.coordinates[0].slice(0,-1)),
b.polygon)}return null},createLayers:function(a){this.layers={};var b={maxZoom:18,noWrap:!0};a&&(a.subdomains&&0<a.subdomains.length)&&(b.subdomains=a.subdomains);for(var a=["Base","Reference","Selection","Labels"],c=0;c<a.length;c++)b.zIndex=2+c,this.layers[a[c].toLowerCase()]={name:a[c],obj:new L.TileLayer(null,b)};this.layers["drawn features"]={name:"Drawn Features",obj:new L.FeatureGroup}},destroy:function(){this.input&&(this.input.parentNode.removeChild(this.input),delete this.input);if(this.map){this.modeControl&&
(this.map.removeControl(this.modeControl),delete this.modeControl);this._toggleControl&&(this._toggleControl.off("layer:settings-changed",this._onLayerSettingsChanged),this.map.removeControl(this._toggleControl),delete this._toggleControl);this._geoLocateControl&&(this.map.removeControl(this._geoLocateControl),delete this._geoLocateControl);if(this.layers){for(var a in this.layers)this.map.removeLayer(this.layers[a]);this.layers={}}delete this.map}this._pushValueTimeout&&(clearTimeout(this._pushValueTimeout),
delete this._pushValueTimeout);document.getElementById(this._element).innerHTML="";delete this._element;delete this.options},pushValue:function(){this._pushValueTimeout&&clearTimeout(this._pushValueTimeout);this._pushValueTimeout=setTimeout(L.Util.bind(this._pushValueDelay,this),50)},setBaseMap:function(a){this.options.baseTileSetId=a;this.setLayer("base",a)},setBounds:function(a){if(a){var b=["minY","minX","maxY","maxX"],c;if(a)for(c=0;c<b.length;c++)if("undefined"==typeof a[b[c]]){a=null;break}if(this.bounds){var d=
!0;for(c=0;c<b.length;c++)a[b[c]]!==this.bounds[b[c]]&&(d=!1);if(d)return}this.bounds={minX:a.minX,maxX:a.maxX,minY:a.minY,maxY:a.maxY};this.options.bounds={minX:a.minX,maxX:a.maxX,minY:a.minY,maxY:a.maxY};setTimeout(L.Util.bind(function(){this.map&&(this.map.fitBounds([[a.minY,a.minX],[a.maxY,a.maxX]]),this.updateValue(!1))},this),100)}},setGeoLocation:function(){this.options.geolocate?!this._geoLocateControl&&navigator.geolocation&&(this._geoLocateControl=new L.Control.Locate({position:"bottomright",
follow:!1,metric:!0}),this._geoLocateControl.addTo(this.map)):this._geoLocateControl&&(this.map.removeControl(this._geoLocateControl),delete this._geoLocateControl)},setLayer:function(a,b,c){var d=this.layers[a],c=c||"",e=this.options.layerUrlTemplate;d&&(b?(b=e.replace(/\{ *(TileSetId+) *\}/g,b).replace(/\{ *(Layer+) *\}/g,c),c=!d.obj._url||d.obj._url!==b,d.obj.setUrl(b),this._toggleControl.addLayer(d),(c||this.options.layerOptions&&!0===this.options.layerOptions[a])&&this._toggleControl.showLayer(d)):
this._toggleControl.removeLayer(d))},setMode:function(a){a=a.toLowerCase();if(!this.modeControl||!this.options||!(this.options.mode&&this.options.mode==a)){this.options.mode=a;var b;this.map.off("moveend",this._onMapMoved);L.DomUtil.removeClass(this.map._container,"bounds");this._toggleControl&&(this._toggleControl.removeLayer(this.layers["drawn features"]),this._toggleControl.removeLayer(this.layers.selection));switch(a){case "select":a={multiple:this.options.multiple,selectionUrlTemplate:this.options.selectionUrlTemplate};
b=new L.Control.Select(a);b.on("selection-changed",this._onSelectionChanged,this);break;case "draw":a={polyline:!1,polygon:!1,point:!1,label:this.options.labelFeatures,multiple:this.options.multiple,layer:this.layers["drawn features"].obj};this.options.drawPoints&&delete a.point;this.options.drawLines&&delete a.polyline;this.options.drawPolygons&&delete a.polygon;b=new L.Control.Draw(a);b.on("features-changed",this._onFeaturesChanged,this);this._toggleControl&&(this._toggleControl.addLayer(this.layers["drawn features"]),
this.options.layerOptions&&!0===this.options.layerOptions["drawn features"]&&this._toggleControl.showLayer(this.layers["drawn features"]));break;case "bound":L.DomUtil.addClass(this.map._container,"bounds"),b="bounds",this.map.on("moveend",this._onMapMoved,this)}this.modeControl&&(this.modeControl.off&&(this.modeControl.off("features-changed",this._onFeaturesChanged),this.modeControl.off("selection-changed",this._onSelectionChanged),this.map.removeControl(this.modeControl)),delete this.modeControl);
b&&(this.modeControl=b,this.modeControl.addTo&&this.modeControl.addTo(this.map),this.options.referenceTileSetId&&(this.modeControl.setTileSetId&&this.modeControl.setTileSetId(this.options.referenceTileSetId),this.modeControl.setLabelField&&this.options.labelField&&this.modeControl.setLabelField(this.options.labelField)));this.updateValue()}},setOptions:function(a){a!==this.options&&(this.options=L.Util.extend({},this.options||{},a||{}),this.setGeoLocation(),this.buildInputField(),this.setBounds(this.options.bounds),
this.options.mode&&(this.options.mode=this.options.mode.toLowerCase()),this.setMode(this.options.mode),this.setBaseMap(this.options.baseTileSetId),this.setReferenceLayer(this.options.referenceTileSetId),this.setReferenceLayerLabel(this.options.labelField),this.updateValue())},setReferenceLayer:function(a){this.options.referenceTileSetId=a;this.setLayer("reference",a);a&&(this.modeControl&&this.modeControl.setTileSetId)&&this.modeControl.setTileSetId(a)},setReferenceLayerLabel:function(a){var b=(this.options.labelField=
a)?this.options.referenceTileSetId:null;this.setLayer("labels",b,a?"L-"+encodeURIComponent(a):null);b&&(a&&this.modeControl&&this.modeControl.setLabelField)&&this.modeControl.setLabelField(a)},setValue:function(a){if(a){this.setBounds(a.bounds);var b=(this.options.mode||"").toLowerCase();"draw"==b&&a.data?this.addFeatures(a.data):"select"==b&&a.selectionStack&&(this.modeControl.setSelectionStack(a.selectionStack),this.updateValue(!1))}},updateValue:function(a){var b,c;switch((this.options.mode||"").toLowerCase()){case "draw":b=
this._getDrawValue();c=b.value;b=b.bounds;break;case "select":c='"selectionStack":"'+this._getSelectValue()+'"';break;case "bound":try{b=this.map.getBounds().pad(-0.05)}catch(d){return}}b?(b=b.toBBoxString().split(","),b='"bounds":{"minX":'+parseFloat(b[0]).toFixed(6)+',"minY":'+parseFloat(b[1]).toFixed(6)+',"maxX":'+parseFloat(b[2]).toFixed(6)+',"maxY":'+parseFloat(b[3]).toFixed(6)+"}"):b='"bounds":{"minX":'+this.bounds.minX+',"minY":'+this.bounds.minY+',"maxX":'+this.bounds.maxX+',"maxY":'+this.bounds.maxY+
"}";this.input&&(this.input.value="{"+b+(c?","+c:"")+"}");!1!==a&&this.pushValue()},_getDrawValue:function(){var a,b,c=[],d=this.options.labelFeatures;this.modeControl.eachLayer(function(e){a||(a=new L.LatLngBounds);"point"==e.options.type?a.extend(e.getLatLng()):a.extend(e.getBounds());b=e.toGeoJSON();b=b.replace(/\"/g,'\\"');c.push("["+(d?'"'+AlteryxJS.Util.escapeJson(e.options.label||"")+'",':"")+'"'+b+'"]')});a&&a.pad(0.1);c='"fields":['+(d?'{"name":"Label"},':"")+'{"name":"SpatialObj"}],"data":['+
c.join(",")+"]";return{value:c,bounds:a}},_getSelectValue:function(){return AlteryxJS.Util.escapeJson(this.modeControl.getSelectionStack())},_flipCoordinates:function(a){a.unshift(a.pop());return a},_flipLineString:function(a){var b,c=a.length;for(b=0;b<c;b++)this._flipCoordinates(a[b]);return a},_onFeaturesChanged:function(){this._toggleControl&&this._toggleControl.showLayer(this.layers["drawn features"]);this.updateValue()},_onLayerSettingsChanged:function(a){"undefined"!=typeof AlteryxComm&&AlteryxComm.fire("settingschanged",
a.settings)},_onSelectionChanged:function(a){var b=a.stack.options.selectionId;b&&""!==b?(this.setLayer("selection",this.options.referenceTileSetId,"S-"+a.stack.options.selectionId),this._toggleControl&&this._toggleControl.showLayer(this.layers.selection)):this._toggleControl&&this._toggleControl.removeLayer(this.layers.selection);this.updateValue()},_onMapMoved:function(){this.updateValue()},_pushValueDelay:function(){"undefined"!=typeof AlteryxComm&&AlteryxComm.fire("change",this.input.value)}})})();
